<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elsa App</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: black;
      color: gold;
    }
    .tab-bar {
      position: fixed;
      bottom: 0;
      display: flex;
      width: 100%;
      background: #111;
    }
    .tab-bar button {
      flex: 1;
      padding: 1rem;
      color: gold;
      background: none;
      border: none;
      font-weight: bold;
    }
    .page {
      display: none;
      padding: 1rem;
      padding-bottom: 60px;
    }
    .active { display: block; }
    canvas { background: #222; margin-top: 1rem; }
    input, button {
      width: 100%;
      padding: 0.6rem;
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;background:#111;padding:1rem;">Elsa Market</h2>

  <!-- Login Page -->
  <div id="loginPage" class="page active">
    <h3>Login or Register</h3>
    <input id="email" placeholder="Email" type="email" />
    <input id="password" placeholder="Password" type="password" />
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
  </div>

  <!-- Home Page -->
  <div id="homePage" class="page">
    <h3>Welcome <span id="userEmail"></span></h3>
    <p>Balance: $<span id="balance">0.00</span></p>
    <p>Referral Code: <span id="refCode"></span></p>
    <canvas id="priceChart" height="120"></canvas>
  </div>

  <!-- Market Page -->
  <div id="marketPage" class="page">
    <h3>Market</h3>
    <p>Buy for $2:</p>
    <button onclick="buy('Gold')">Buy Gold</button>
    <button onclick="buy('Diamond')">Buy Diamond</button>
    <button onclick="buy('SOL')">Buy SOL</button>
    <p>Sell for $2.60 (Verified only):</p>
    <button onclick="sell('Gold')">Sell Gold</button>
    <button onclick="sell('Diamond')">Sell Diamond</button>
    <button onclick="sell('SOL')">Sell SOL</button>
  </div>

  <!-- Wallet Page -->
  <div id="walletPage" class="page">
    <h3>Wallet</h3>
    <p>Balance: $<span id="walletBalance">0.00</span></p>
    <button onclick="deposit()">Deposit â‚¦1000</button>
    <button onclick="withdraw()">Withdraw ($4 min)</button>
  </div>

  <!-- Earn Page -->
  <div id="earnPage" class="page">
    <h3>Verify ID</h3>
    <input id="idUrl" placeholder="Paste ID Image URL" />
    <button onclick="uploadID()">Submit</button>
    <p id="verifyStatus"></p>
  </div>

  <!-- Leaderboard -->
  <div id="leaderboardPage" class="page">
    <h3>Top Earners</h3>
    <ul id="topEarners"></ul>
    <h3>Top Referrals</h3>
    <ul id="topReferrals"></ul>
  </div>

  <!-- Profile Page -->
  <div id="profilePage" class="page">
    <h3>My Profile</h3>
    <p>Email: <span id="profileEmail"></span></p>
    <p>Status: <span id="profileVerified"></span></p>
    <p>Total Earnings: $<span id="profileEarnings">0</span></p>
    <h4>Resell History</h4>
    <ul id="resellLog"></ul>
  </div>

  <!-- Navigation -->
  <div class="tab-bar">
    <button onclick="showPage('homePage')">ğŸ </button>
    <button onclick="showPage('marketPage')">ğŸ›’</button>
    <button onclick="showPage('walletPage')">ğŸ’¼</button>
    <button onclick="showPage('earnPage')">ğŸ¯</button>
    <button onclick="showPage('leaderboardPage')">ğŸ†</button>
    <button onclick="showPage('profilePage')">ğŸ‘¤</button>
  </div>

  <footer style="text-align:center;padding:1rem;">Endorsed by Reverend</footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
      authDomain: "elsa-ab176.firebaseapp.com",
      projectId: "elsa-ab176",
      storageBucket: "elsa-ab176.firebasestorage.app",
      messagingSenderId: "850786583459",
      appId: "1:850786583459:android:5710287d8738f48e8e1016"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUser = null;

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'leaderboardPage') loadLeaderboard();
      if (id === 'profilePage') loadProfile();
    }

    function register() {
      const email = emailInput.value;
      const pass = passwordInput.value;
      auth.createUserWithEmailAndPassword(email, pass).then(cred => {
        const bal = email === 'eluxxes@gmail.com' ? 10 : 0;
        return db.collection('users').doc(cred.user.uid).set({
          email, balance: bal, earnings: 0, referrals: 0, verified: false, uid: cred.user.uid
        });
      }).then(() => login());
    }

    function login() {
      const email = emailInput.value;
      const pass = passwordInput.value;
      auth.signInWithEmailAndPassword(email, pass).then(cred => {
        currentUser = cred.user;
        showPage('homePage');
        loadUser();
        loadChart();
      });
    }

    function loadUser() {
      const ref = db.collection('users').doc(currentUser.uid);
      ref.onSnapshot(doc => {
        const d = doc.data();
        userEmail.innerText = d.email;
        balance.innerText = d.balance.toFixed(2);
        walletBalance.innerText = d.balance.toFixed(2);
        refCode.innerText = currentUser.uid;
        verifyStatus.innerText = d.verified ? 'âœ” Verified' : 'Not Verified';
      });
    }

    function deposit() {
      window.open('https://paystack.com/buy/lilzok-vjmgrv', '_blank');
      alert('Deposit â‚¦1000 via Paystack. Your balance will be updated manually.');
    }

    function withdraw() {
      const ref = db.collection('users').doc(currentUser.uid);
      ref.get().then(doc => {
        const d = doc.data();
        if (d.balance >= 4) {
          ref.update({ balance: d.balance - 4 });
          alert('Withdrawal of $4 processed (manually).');
        } else {
          alert('Minimum $4 required.');
        }
      });
    }

    function buy(item) {
      const ref = db.collection('users').doc(currentUser.uid);
      db.runTransaction(async t => {
        const docSnap = await t.get(ref);
        const d = docSnap.data();
        if (d.balance >= 2) {
          t.update(ref, { balance: d.balance - 2 });
          alert(item + ' bought.');
        } else alert('Insufficient funds');
      });
    }

    function sell(item) {
      const ref = db.collection('users').doc(currentUser.uid);
      ref.get().then(doc => {
        const d = doc.data();
        if (!d.verified) return alert('You must be verified.');
        const amt = 2.45;
        ref.update({
          balance: d.balance + amt,
          earnings: (d.earnings || 0) + amt
        });
        db.collection('resells').add({
          uid: currentUser.uid,
          email: d.email,
          item, amount: amt,
          time: new Date().toLocaleString()
        });
        alert('Sold for $2.60 (you get $2.45)');
      });
    }

    function uploadID() {
      const url = idUrl.value;
      if (!url) return alert('Paste ID URL');
      db.collection('users').doc(currentUser.uid).update({
        verified: true, id_uploaded: true, id_url: url
      });
      alert('Verified. You can now sell.');
    }

    function loadChart() {
      const ctx = document.getElementById('priceChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Price', data: [], borderColor: 'gold' }] },
        options: { scales: { y: { beginAtZero: true } } }
      });
      setInterval(() => {
        db.collection('settings').doc('prices').get().then(doc => {
          const data = doc.data();
          const now = new Date().toLocaleTimeString();
          chart.data.labels.push(now);
          chart.data.datasets[0].data.push((data.gold + data.diamond + data.sol) / 3);
          if (chart.data.labels.length > 10) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        });
      }, 30000);
    }

    function loadLeaderboard() {
      db.collection('users').orderBy('earnings', 'desc').limit(5).get().then(snap => {
        topEarners.innerHTML = '';
        snap.forEach(doc => {
          const d = doc.data();
          topEarners.innerHTML += `<li>${d.email}: $${d.earnings.toFixed(2)}</li>`;
        });
      });
      db.collection('users').orderBy('referrals', 'desc').limit(5).get().then(snap => {
        topReferrals.innerHTML = '';
        snap.forEach(doc => {
          const d = doc.data();
          topReferrals.innerHTML += `<li>${d.email}: ${d.referrals} referrals</li>`;
        });
      });
    }

    function loadProfile() {
      const ref = db.collection('users').doc(currentUser.uid);
      ref.get().then(doc => {
        const d = doc.data();
        profileEmail.innerText = d.email;
        profileVerified.innerText = d.verified ? 'âœ” Verified' : 'Not Verified';
        profileEarnings.innerText = d.earnings.toFixed(2);
      });
      db.collection('resells').where('uid', '==', currentUser.uid).get().then(snap => {
        resellLog.innerHTML = '';
        snap.forEach(doc => {
          const d = doc.data();
          resellLog.innerHTML += `<li>${d.item} - $${d.amount} - ${d.time}</li>`;
        });
      });
    }
  </script>
</body>
</html>
