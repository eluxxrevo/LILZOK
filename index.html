<!-- ELSA COIN APP: COMBINED HTML FILE PART 3/3 --><!-- This file contains: Withdrawal Logic, Verification Tiers, Trade Page, Comment Section --><!-- Continue from Part 1 and Part 2 above --><!-- 🔁 Withdraw & Verification Logic --><section id="withdraw-section" class="hidden">
  <h2>Withdraw Funds</h2>
  <form id="withdraw-form">
    <label>Amount ($): <input type="number" min="5" id="withdraw-amount" required></label>
    <label>Bank Type:
      <select id="withdraw-bank">
        <option>Opay</option>
        <option>Palmpay</option>
        <option>Moniepoint</option>
        <option>First Bank</option>
        <option>FCMB</option>
        <option>Kuda</option>
        <option>Eco</option>
        <option>Zenith</option>
        <option>Access</option>
      </select>
    </label>
    <label>Account Number: <input type="text" id="withdraw-account" required></label>
    <button type="submit">Submit Withdrawal</button>
  </form>
  <div id="withdraw-history"></div>
</section><!-- 🛡️ Verification Tiers --><section id="verify-section" class="hidden">
  <h2>Verify Account</h2>
  <div class="tier-box">
    <h3>Little Bird</h3>
    <p>8 referrals, ID upload, $1 fee</p>
    <button class="verify-btn" data-tier="little">Verify</button>
  </div>
  <div class="tier-box">
    <h3>Boss</h3>
    <p>20 referrals, ID, $5 fee, low fees</p>
    <button class="verify-btn" data-tier="boss">Verify</button>
  </div>
  <div class="tier-box">
    <h3>Lord</h3>
    <p>1,000 referrals, ID, $50 fee, extra privileges</p>
    <button class="verify-btn" data-tier="lord">Verify</button>
  </div>
  <div class="tier-box">
    <h3>Platinum</h3>
    <p>10,000 referrals, ID, $500 fee, no monthly fee</p>
    <button class="verify-btn" data-tier="platinum">Verify</button>
  </div>
</section><!-- 💹 Trade Page with Buy/Sell Suggestions --><section id="trade-page" class="hidden">
  <h2>Live Trade Assistant</h2>
  <div id="trade-suggestions">
    <p>📊 Analyzing chart data...</p>
    <p id="trade-advice">Suggestion: Hold</p>
  </div>
  <div id="copy-trade">
    <h3>📋 Copy Traders</h3>
    <ul id="top-traders"></ul>
  </div>
</section><!-- 💬 Comments Section --><section id="chart-comments" class="hidden">
  <h3>💬 Chart Comments</h3>
  <div id="comments-list"></div>
  <form id="comment-form">
    <input type="text" placeholder="Leave a comment..." id="comment-input">
    <button type="submit">Send</button>
  </form>
</section><!-- ⚙️ Settings Page --><section id="settings-page" class="hidden">
  <h2>Settings</h2>
  <label>Theme:
    <select id="theme-toggle">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
  </label>
  <button onclick="logoutUser()">Logout</button>
</section><!-- 🔔 Notification Toast --><div id="toast" class="hidden"></div><!-- ✅ Script Integrations --><script>
// Withdraw submission
withdrawForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const amount = parseFloat(document.getElementById("withdraw-amount").value);
  const account = document.getElementById("withdraw-account").value;
  const bank = document.getElementById("withdraw-bank").value;
  if (amount < 5) return showToast("Minimum $5 withdrawal.");
  const user = auth.currentUser;
  if (!user) return showToast("Please login.");
  db.collection("withdrawals").add({
    uid: user.uid,
    email: user.email,
    amount,
    account,
    bank,
    status: "pending",
    date: new Date().toISOString(),
  }).then(() => showToast("✅ Request submitted. You'll be credited in 2 hours"));
});

// Comments
commentForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const text = commentInput.value;
  const user = auth.currentUser;
  if (text && user) {
    db.collection("comments").add({
      text,
      user: user.email,
      date: Date.now()
    });
    commentInput.value = "";
    showToast("Comment posted.");
  }
});

// Copy traders mock
const topTraders = ["@CryptoKing", "@DivaTrade", "@SatoshiBot"];
const topList = document.getElementById("top-traders");
topTraders.forEach(t => topList.innerHTML += `<li>🤖 ${t} <button>Copy</button></li>`);

function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.innerText = msg;
  toast.classList.remove("hidden");
  setTimeout(() => toast.classList.add("hidden"), 3000);
}
</script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyApuMISYyAXo7Xdxa_FAYDG-tHaU5vJA6A",
    authDomain: "elsa-809c1.firebaseapp.com",
    projectId: "elsa-809c1",
    storageBucket: "elsa-809c1.firebasestorage.app",
    messagingSenderId: "401983741723",
    appId: "1:401983741723:android:253c41bf6a9011d0483dbe"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Welcome Animation Transition
  setTimeout(() => {
    document.querySelector("#welcome").style.display = "none";
    document.querySelector("#language").style.display = "block";
  }, 3000);

  // Language Selection
  function selectLang(lang) {
    document.querySelector("#language").style.display = "none";
    document.querySelector("#auth").style.display = "block";
  }

  // Login/Register Switch
  function toggleAuth(mode) {
    document.getElementById("login").style.display = (mode === 'login') ? "block" : "none";
    document.getElementById("register").style.display = (mode === 'register') ? "block" : "none";
  }

  // Auth Logic
  const loginForm = document.querySelector("#loginForm");
  const registerForm = document.querySelector("#registerForm");

  loginForm.onsubmit = async (e) => {
    e.preventDefault();
    const email = loginForm.email.value;
    const password = loginForm.password.value;
    try {
      const cred = await auth.signInWithEmailAndPassword(email, password);
      loadUser(cred.user.uid);
    } catch (err) {
      showAlert("Invalid login credentials", "error");
    }
  };

  registerForm.onsubmit = async (e) => {
    e.preventDefault();
    const email = registerForm.email.value;
    const password = registerForm.password.value;
    try {
      const cred = await auth.createUserWithEmailAndPassword(email, password);
      await db.collection("users").doc(cred.user.uid).set({
        email: email,
        balance: 0,
        elsa: 0,
        referrals: 0,
        verified: false,
        type: "normal",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      showAlert("Registered successfully!", "success");
      loadUser(cred.user.uid);
    } catch (err) {
      showAlert("Registration failed", "error");
    }
  };

  // Show Alert
  function showAlert(msg, type) {
    const div = document.createElement("div");
    div.textContent = msg;
    div.className = "alert " + type;
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 2500);
  }

  // Load User Dashboard
  function loadUser(uid) {
    db.collection("users").doc(uid).onSnapshot(doc => {
      const user = doc.data();
      document.querySelector("#auth").style.display = "none";
      document.querySelector("#app").style.display = "block";

      document.querySelector("#username").textContent = user.email;
      document.querySelector("#balance").textContent = `$${user.balance.toFixed(2)}`;
      document.querySelector("#elsaBalance").textContent = `${user.elsa.toFixed(4)} ELSA`;

      if (user.verified) {
        document.querySelector("#verifyBadge").style.display = "inline-block";
      }

      // Referral logic
      const refLink = `${window.location.href}?ref=${uid.slice(0, 6)}`;
      document.querySelector("#referralLink").value = refLink;
    });
  }

  // Copy Referral
  function copyReferral() {
    const refInput = document.querySelector("#referralLink");
    refInput.select();
    navigator.clipboard.writeText(refInput.value);
    showAlert("Referral link copied!", "success");
  }

  // Manual Withdrawal Request
  const withdrawForm = document.querySelector("#withdrawForm");
  withdrawForm.onsubmit = async (e) => {
    e.preventDefault();
    const amount = +withdrawForm.amount.value;
    const type = withdrawForm.walletType.value;
    const number = withdrawForm.walletNumber.value;
    const user = auth.currentUser;

    const doc = await db.collection("users").doc(user.uid).get();
    const data = doc.data();

    if (amount > data.balance) return showAlert("Insufficient funds", "error");

    await db.collection("withdrawals").add({
      uid: user.uid,
      amount,
      type,
      number,
      status: "pending",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    await db.collection("users").doc(user.uid).update({
      balance: data.balance - amount
    });

    showAlert("Withdrawal request submitted", "success");
  };

  // Buy Elsa
  async function buyElsa() {
    const usd = +document.getElementById("buyAmount").value;
    const user = auth.currentUser;
    const doc = await db.collection("users").doc(user.uid).get();
    const userData = doc.data();
    const price = 2000;
    const elsa = usd / price;

    if (userData.balance < usd) return showAlert("Insufficient funds", "error");

    await db.collection("users").doc(user.uid).update({
      balance: userData.balance - usd,
      elsa: userData.elsa + elsa
    });

    showAlert("Purchased Elsa successfully!", "success");
  }

  // Fake Live Chart
  setInterval(() => {
    const price = 2000 + Math.floor(Math.random() * 200) - 100;
    document.getElementById("livePrice").innerText = `$${price}`;
    const candle = document.getElementById("chartCandle");
    candle.style.height = (50 + Math.random() * 50) + "%";
  }, 3000);

</script>
