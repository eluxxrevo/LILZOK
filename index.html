<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elsa App</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: gold;
    }
    header {
      background: #111;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
    section { display: none; padding: 1rem; }
    section.active { display: block; }
    input, button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
    }
    button { background: gold; color: black; font-weight: bold; }
    .tabs {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      display: flex;
      border-top: 1px solid gold;
    }
    .tabs button {
      flex: 1;
      background: transparent;
      color: gold;
      border: none;
      padding: 10px;
      font-size: 1rem;
    }
    canvas { background: #222; border-radius: 10px; margin-top: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>Elsa App</header>  <section id="login" class="active">
    <h2>Login</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p>Don't have an account? <a href="#" onclick="show('register')">Register</a></p>
  </section>  <section id="register">
    <h2>Register</h2>
    <input id="regEmail" placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">
    <input id="refCode" placeholder="Referral code (optional)">
    <button onclick="register()">Register</button>
    <p>Already have an account? <a href="#" onclick="show('login')">Login</a></p>
  </section>  <section id="market">
    <h2>Live Commodity Chart</h2>
    <canvas id="liveChart"></canvas>
    <p>Current Price: $<span id="currentPrice">2.00</span></p>
    <button onclick="buy()">Buy at $2</button>
    <button onclick="sell()">Sell at $2.60</button>
  </section>  <section id="wallet">
    <h2>Your Wallet</h2>
    <p>Email: <span id="userEmail"></span></p>
    <p>Balance: $<span id="userBalance"></span></p>
    <p>Status: <span id="userStatus"></span></p>
    <button onclick="verify()">Verify ($1.50)</button>
    <button onclick="deposit()">Deposit</button>
    <button onclick="withdraw()">Withdraw</button>
  </section>  <section id="profile">
    <h2>Your Profile</h2>
    <p>Referral Link:</p>
    <input id="referralLink" readonly>
    <p>Referrals: <span id="refCount"></span>/8</p>
  </section>  <section id="leaderboard">
    <h2>Leaderboard</h2>
    <div id="leaderboardList">Loading...</div>
  </section>  <div class="tabs hidden" id="navTabs">
    <button onclick="navigate('market')"><i class="material-icons">show_chart</i></button>
    <button onclick="navigate('wallet')"><i class="material-icons">account_balance_wallet</i></button>
    <button onclick="navigate('profile')"><i class="material-icons">person</i></button>
    <button onclick="navigate('leaderboard')"><i class="material-icons">emoji_events</i></button>
  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      updateDoc,
      collection,
      addDoc,
      onSnapshot,
      getDocs,
      increment,
      query,
      orderBy,
      limit
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
      projectId: "elsa-ab176",
      appId: "1:850786583459:android:5710287d8738f48e8e1016"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const $ = id => document.getElementById(id);
    const show = page => {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      $(page).classList.add("active");
    };
    const navigate = page => show(page);

    window.register = async () => {
      const email = $("regEmail").value;
      const password = $("regPassword").value;
      const refCode = $("refCode").value;
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, "users", userCred.user.uid), {
        email,
        balance: email === "eluxxes@gmail.com" ? 10 : 0,
        verified: false,
        referrals: 0,
        referredBy: refCode || null
      });
      if (refCode) {
        const q = query(collection(db, "users"));
        const snap = await getDocs(q);
        snap.forEach(async userDoc => {
          if (userDoc.id === refCode) {
            await updateDoc(doc(db, "users", refCode), {
              referrals: increment(1)
            });
          }
        });
      }
      login();
    };

    window.login = async () => {
      try {
        const email = $("loginEmail").value;
        const password = $("loginPassword").value;
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        init(userCred.user);
      } catch (e) {
        alert("Login failed");
      }
    };

    const init = async user => {
      $("login").classList.remove("active");
      $("navTabs").classList.remove("hidden");
      navigate("wallet");
      const snap = await getDoc(doc(db, "users", user.uid));
      const data = snap.data();
      $("userEmail").innerText = data.email;
      $("userBalance").innerText = data.balance.toFixed(2);
      $("userStatus").innerText = data.verified ? "âœ… Verified" : "Not Verified";
      $("referralLink").value = `${location.origin}?ref=${user.uid}`;
      $("refCount").innerText = data.referrals;
      loadLeaderboard();
    };

    window.verify = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const d = snap.data();
      if (d.balance >= 1.5) {
        await updateDoc(ref, { verified: true, balance: d.balance - 1.5 });
        alert("Verified successfully");
      } else alert("Insufficient funds");
    };

    window.deposit = () => {
      window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");
    };

    window.withdraw = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const d = snap.data();
      if (d.balance >= 4) {
        await updateDoc(ref, { balance: d.balance - 4 });
        alert("Withdraw success");
      } else alert("Min $4 to withdraw");
    };

    window.buy = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const d = snap.data();
      if (d.balance >= 2) {
        await updateDoc(ref, { balance: d.balance - 2 });
        await addDoc(collection(db, "resales"), { price: 2.6, time: Date.now() });
        alert("Bought successfully");
      } else alert("Insufficient funds");
    };

    window.sell = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const d = snap.data();
      if (d.verified) {
        await updateDoc(ref, { balance: d.balance + 2.6 });
        alert("Sold successfully");
      } else alert("You must be verified to sell");
    };

    function loadLeaderboard() {
      const q = query(collection(db, "users"), orderBy("referrals", "desc"), limit(10));
      getDocs(q).then(snap => {
        let html = '<ol>';
        snap.forEach(docu => {
          const d = docu.data();
          html += `<li>${d.email}: ${d.referrals} referrals</li>`;
        });
        html += '</ol>';
        $("leaderboardList").innerHTML = html;
      });
    }

    onSnapshot(collection(db, "resales"), snap => {
      const data = snap.docs.map(doc => doc.data().price);
      if (chart) {
        chart.data.labels = data.map((_, i) => i);
        chart.data.datasets[0].data = data;
        chart.update();
      }
      $("currentPrice").innerText = data[data.length - 1]?.toFixed(2) || '2.00';
    });

    let chart;
    setTimeout(() => {
      chart = new Chart($("liveChart"), {
        type: 'line',
        data: {
          labels: [],
          datasets: [{ label: 'Price', borderColor: 'gold', data: [] }]
        },
        options: {
          responsive: true,
          scales: { x: { display: false } }
        }
      });
    }, 500);

    onAuthStateChanged(auth, user => { if (user) init(user); });
  </script></body>
</html>
