<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supreme Elsa App</title>
    <style>
        body {
            background-color: #1a1a1a; /* Royal black */
            color: #ffd700; /* Gold */
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 1200px;
            padding: 20px;
            text-align: center;
        }
        h1, h2, h3 {
            color: #ffd700;
        }
        button {
            background-color: #ffd700;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        input, select {
            background-color: #333;
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
        }
        .auth-box, .trade-box, .chat-box, .withdraw-box {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .splash-screen h1 {
            font-size: 48px;
            animation: pulse 3s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        canvas {
            max-width: 100%;
            height: 300px;
            margin: 20px 0;
        }
        #comments, #transactions, #transaction-list, #top-resellers, #top-referrers, #chat-messages {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="splash-screen" class="page active">
        <div class="splash-screen">
            <h1>Supreme Elsa</h1>
        </div>
    </div>

    <div id="auth-page" class="page">
        <div class="container">
            <h1>Supreme Elsa</h1>
            <div class="auth-box">
                <h2>Login</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-password" placeholder="Password (12+ chars)" required>
                    <button type="submit">Login</button>
                </form>
                <h2>Register</h2>
                <form id="register-form">
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="email" id="register-email" placeholder="Email" required>
                    <input type="password" id="register-password" placeholder="Password (12+ chars)" required>
                    <select id="language" required>
                        <option value="en">English</option>
                        <option value="fr">French</option>
                    </select>
                    <button type="submit">Register</button>
                </form>
                <p>Password: 12+ chars with letters, numbers, symbols.</p>
            </div>
        </div>
    </div>

    <div id="home-page" class="page">
        <div class="container">
            <h1>Elsa Price: $<span id="elsa-price">2000</span></h1>
            <canvas id="candlestick-chart"></canvas>
            <div class="trade-box">
                <input type="number" id="elsa-amount" placeholder="Amount of Elsa" step="0.0001">
                <button id="buy-btn">Buy</button>
                <button id="sell-btn" disabled>Complete Verification to Resell</button>
            </div>
            <div class="comment-section">
                <h3>Community Comments</h3>
                <div id="comments"></div>
                <input type="text" id="comment-input" placeholder="Add a comment...">
                <button onclick="postComment()">Post</button>
            </div>
            <button onclick="showPage('user-page')">User Profile</button>
            <button onclick="showPage('leaderboard-page')">Leaderboard</button>
            <button onclick="showPage('transactions-page')">Transactions</button>
            <button onclick="showPage('support-page')">Support</button>
        </div>
    </div>

    <div id="user-page" class="page">
        <div class="container">
            <img id="user-avatar" src="https://via.placeholder.com/100?text=Avatar" alt="User Avatar">
            <h2 id="username"></h2>
            <p>User ID: <span id="user-id"></span></p>
            <p>Email: <span id="email"></span></p>
            <p>Referral Code: <span id="referral-code"></span></p>
            <p>Verification: <span id="verification"></span></p>
            <p>Wallet Balance: $<span id="wallet-balance">0</span></p>
            <button onclick="showWithdrawForm()">Withdraw</button>
            <button onclick="deposit()">Deposit</button>
            <div class="withdraw-box" id="withdraw-form" style="display: none;">
                <h3>Withdrawal Request</h3>
                <select id="bank-name" required>
                    <option value="">Select Bank</option>
                    <option value="Opay">Opay</option>
                    <option value="Palmpay">Palmpay</option>
                    <option value="Moniepoint">Moniepoint</option>
                    <option value="Kuda">Kuda</option>
                    <option value="FCMB">FCMB</option>
                    <option value="UBA">UBA</option>
                    <option value="Access">Access</option>
                    <option value="Eco">Eco</option>
                    <option value="Union">Union</option>
                    <option value="Fidelity">Fidelity</option>
                </select>
                <input type="text" id="account-number" placeholder="Account Number" required>
                <input type="number" id="withdraw-amount" placeholder="Amount in USD" required>
                <button onclick="submitWithdrawal()">Submit Withdrawal</button>
            </div>
            <h3>Transaction History</h3>
            <ul id="transactions"></ul>
            <h3>Settings</h3>
            <input type="text" id="new-username" placeholder="New Username">
            <input type="password" id="new-password" placeholder="New Password">
            <button onclick="updateProfile()">Update Profile</button>
            <button onclick="showPage('home-page')">Back to Home</button>
        </div>
    </div>

    <div id="leaderboard-page" class="page">
        <div class="container">
            <h1>Leaderboard</h1>
            <h3>Top Resellers</h3>
            <ul id="top-resellers"></ul>
            <h3>Top Referrers</h3>
            <ul id="top-referrers"></ul>
            <button onclick="showPage('home-page')">Back to Home</button>
        </div>
    </div>

    <div id="transactions-page" class="page">
        <div class="container">
            <h1>Transaction History</h1>
            <ul id="transaction-list"></ul>
            <button onclick="showPage('home-page')">Back to Home</button>
        </div>
    </div>

    <div id="support-page" class="page">
        <div class="container">
            <h1>Customer Support</h1>
            <p>Contact: <a href="mailto:eluxxes@gmail.com">eluxxes@gmail.com</a></p>
            <div class="chat-box">
                <div id="chat-messages"></div>
                <input type="text" id="chat-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>
            <button onclick="showPage('home-page')">Back to Home</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.0/dist/chartjs-chart-financial.min.js"></script>
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyApuMISYyAXo7Xdxa_FAYDG-tHaU5vJA6A",
            authDomain: "elsa-809c1.firebaseapp.com",
            projectId: "elsa-809c1",
            storageBucket: "elsa-809c1.firebasestorage.app",
            messagingSenderId: "401983741723",
            appId: "1:401983741723:android:253c41bf6a9011d0483dbe"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Page Navigation with Auth Check
        function showPage(pageId) {
            if (pageId !== 'auth-page' && !auth.currentUser) {
                alert("Please log in or register to access this page.");
                showPage('auth-page');
                return;
            }
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        // Splash Screen (3 seconds)
        setTimeout(() => showPage('auth-page'), 3000);

        // Authentication
        document.getElementById("login-form")?.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => showPage('home-page'))
                .catch((error) => alert(error.message));
        });

        document.getElementById("register-form")?.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("register-email").value;
            const password = document.getElementById("register-password").value;
            const username = document.getElementById("username").value;
            const language = document.getElementById("language").value;

            if (!/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{12,}$/.test(password)) {
                alert("Password must be 12+ characters with letters, numbers, and symbols.");
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    db.collection("users").doc(user.uid).set({
                        username,
                        language,
                        userId: Math.random().toString(36).substr(2, 10),
                        referralCode: Math.random().toString(36).substr(2, 8),
                        verification: "none",
                        badge: "none",
                        wallet: 0,
                        referrals: 0,
                        resaleProfit: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        if (email === "eluxxes@gmail.com") {
                            db.collection("users").doc(user.uid).update({
                                verification: "platinum",
                                badge: "golden-lion",
                                wallet: 2000 * 2000
                            });
                        }
                        showPage('home-page');
                    });
                })
                .catch((error) => alert(error.message));
        });

        // User Profile and Wallet
        auth.onAuthStateChanged((user) => {
            if (user) {
                db.collection("users").doc(user.uid).onSnapshot((doc) => {
                    const data = doc.data();
                    document.getElementById("username").textContent = data.username;
                    document.getElementById("user-id").textContent = data.userId;
                    document.getElementById("email").textContent = user.email;
                    document.getElementById("referral-code").textContent = data.referralCode;
                    document.getElementById("verification").textContent = data.verification;
                    document.getElementById("wallet-balance").textContent = data.wallet.toFixed(2);
                    if (data.verification !== "none") {
                        document.getElementById("sell-btn").disabled = false;
                    }
                    if (data.verification === "platinum") {
                        document.getElementById("user-avatar").src = "https://via.placeholder.com/100?text=Golden+Lion";
                    }
                });

                // Transactions
                db.collection("transactions").where("userId", "==", user.uid).get().then((snapshot) => {
                    const transactions = snapshot.docs.map(doc => doc.data());
                    document.getElementById("transactions").innerHTML = transactions.map(t => `<li>${t.type} ${t.amount} Elsa at $${t.price} on ${t.date}</li>`).join("");
                    document.getElementById("transaction-list").innerHTML = transactions.map(t => `<li>${t.type} ${t.amount} Elsa at $${t.price} on ${t.date}</li>`).join("");
                });

                // Leaderboard
                db.collection("users").orderBy("resaleProfit", "desc").limit(10).get().then((snapshot) => {
                    const resellers = snapshot.docs.map(doc => doc.data());
                    document.getElementById("top-resellers").innerHTML = resellers.map(r => `<li>${r.username} - $${r.resaleProfit} (${r.verification})</li>`).join("");
                });
                db.collection("users").orderBy("referrals", "desc").limit(10).get().then((snapshot) => {
                    const referrers = snapshot.docs.map(doc => doc.data());
                    document.getElementById("top-referrers").innerHTML = referrers.map(r => `<li>${r.username} - ${r.referrals} referrals (${r.verification})</li>`).join("");
                });
            } else {
                showPage('auth-page');
            }
        });

        // Candlestick Chart
        let elsaPrice = 2000;
        const chartData = [
            { x: "2025-07-02", open: 2000, high: 2050, low: 1950, close: 2000 }
        ];
        const ctx = document.getElementById("candlestick-chart")?.getContext("2d");
        if (ctx) {
            Chart.register(ChartFinancial);
            const chart = new Chart(ctx, {
                type: "candlestick",
                data: {
                    datasets: [{
                        label: "Elsa Price",
                        data: chartData
                    }]
                },
                options: {
                    scales: {
                        x: { time: { unit: "day" } },
                        y: { beginAtZero: false }
                    }
                }
            });

            // Simulate price updates
            setInterval(() => {
                const change = Math.random() * 100 - 50;
                elsaPrice += change;
                document.getElementById("elsa-price").textContent = elsaPrice.toFixed(2);
                chartData.push({
                    x: new Date().toISOString().split("T")[0],
                    open: chartData[chartData.length - 1].close,
                    high: elsaPrice + Math.random() * 50,
                    low: elsaPrice - Math.random() * 50,
                    close: elsaPrice
                });
                chart.update();
            }, 60000);
        }

        // Buy/Sell Logic
        document.getElementById("buy-btn")?.addEventListener("click", () => {
            const amount = parseFloat(document.getElementById("elsa-amount").value);
            if (amount <= 0) return alert("Invalid amount");
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            db.collection("users").doc(user.uid).get().then((doc) => {
                const data = doc.data();
                if (elsaPrice < 2000 * 0.8 && !["lord", "platinum"].includes(data.verification)) {
                    alert("Only Lord or Platinum users can buy when price is down 20%");
                    return;
                }
                db.collection("transactions").add({
                    userId: user.uid,
                    type: "buy",
                    amount,
                    price: elsaPrice,
                    date: new Date().toISOString()
                });
                db.collection("users").doc(user.uid).update({
                    wallet: firebase.firestore.FieldValue.increment(amount * elsaPrice)
                });
                alert("Purchase successful! Please use Deposit to fund your wallet.");
            });
        });

        document.getElementById("sell-btn")?.addEventListener("click", () => {
            const amount = parseFloat(document.getElementById("elsa-amount").value);
            if (amount <= 0) return alert("Invalid amount");
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            db.collection("users").doc(user.uid).get().then((doc) => {
                const data = doc.data();
                if (data.wallet < amount * elsaPrice) return alert("Insufficient funds");
                let profit = amount * elsaPrice;
                if (elsaPrice < 2000) profit *= 0.7;
                else profit *= 1.3;
                const maintenanceFee = ["bird", "boss"].includes(data.verification) ? 0.1 : data.verification === "lord" ? 0.2 : 0;
                db.collection("transactions").add({
                    userId: user.uid,
                    type: "sell",
                    amount,
                    price: profit,
                    date: new Date().toISOString()
                });
                db.collection("users").doc(user.uid).update({
                    wallet: firebase.firestore.FieldValue.increment(profit - maintenanceFee),
                    resaleProfit: firebase.firestore.FieldValue.increment(profit)
                });
                alert("Sale successful! Use Withdraw to request funds.");
            });
        });

        // Comments
        function postComment() {
            const comment = document.getElementById("comment-input").value;
            if (!comment) return;
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            db.collection("comments").add({
                userId: user.uid,
                username: auth.currentUser.displayName || "User",
                comment,
                likes: 0,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById("comment-input").value = "";
            });
        }

        db.collection("comments").onSnapshot((snapshot) => {
            const comments = snapshot.docs.map(doc => doc.data());
            document.getElementById("comments").innerHTML = comments.map(c => `<p>${c.username}: ${c.comment}</p>`).join("");
        });

        // Deposit (Paystack Placeholder)
        function deposit() {
            alert("Paystack deposit initiated. Configure Paystack SDK for full functionality.");
        }

        // Withdrawal Form
        function showWithdrawForm() {
            document.getElementById("withdraw-form").style.display = "block";
        }

        function submitWithdrawal() {
            const bankName = document.getElementById("bank-name").value;
            const accountNumber = document.getElementById("account-number").value;
            const amount = parseFloat(document.getElementById("withdraw-amount").value);
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            if (!bankName || !accountNumber || amount <= 0) return alert("Please fill all fields");
            
            db.collection("users").doc(user.uid).get().then((doc) => {
                const data = doc.data();
                if (data.verification === "none") return alert("You must be verified to withdraw");
                if (data.wallet < amount) return alert("Insufficient funds");
                
                db.collection("withdrawals").add({
                    userId: user.uid,
                    email: user.email,
                    username: data.username,
                    bankName,
                    accountNumber,
                    amount,
                    status: "pending",
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    db.collection("users").doc(user.uid).update({
                        wallet: firebase.firestore.FieldValue.increment(-amount)
                    });
                    alert("Withdrawal request submitted to eluxxes@gmail.com. You will be credited within 2 hours.");
                    document.getElementById("withdraw-form").style.display = "none";
                    document.getElementById("bank-name").value = "";
                    document.getElementById("account-number").value = "";
                    document.getElementById("withdraw-amount").value = "";
                    
                    console.log(`Withdrawal Request:
                        Email: ${user.email}
                        Username: ${data.username}
                        Bank: ${bankName}
                        Account Number: ${accountNumber}
                        Amount: $${amount}
                        Sent to: eluxxes@gmail.com`);
                });
            });
        }

        // Update Profile
        function updateProfile() {
            const newUsername = document.getElementById("new-username").value;
            const newPassword = document.getElementById("new-password").value;
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            if (newUsername) {
                db.collection("users").doc(user.uid).update({ username: newUsername });
            }
            if (newPassword && /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{12,}$/.test(newPassword)) {
                user.updatePassword(newPassword).then(() => alert("Password updated"));
            } else if (newPassword) {
                alert("Password must be 12+ characters with letters, numbers, and symbols.");
            }
        }

        // Support Chat
        function sendMessage() {
            const comment = document.getElementById("chat-input").value;
            if (!comment) return;
            const user = auth.currentUser;
            if (!user) return alert("Please log in");
            db.collection("support").add({
                userId: user.uid,
                message: comment,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById("chat-input").value = "";
            });
        }

        db.collection("support").onSnapshot((snapshot) => {
            const messages = snapshot.docs.map(doc => doc.data());
            document.getElementById("chat-messages").innerHTML = messages.map(m => `<p>${m.message} (${new Date(m.timestamp?.toDate()).toLocaleString()})</p>`).join("");
        });
    </script>
</body>
            </html>
