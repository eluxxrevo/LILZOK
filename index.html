<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elsa App</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin: 0; font-family: Arial; background: #000; color: gold; }
    .tab-bar {
      position: fixed; bottom: 0; width: 100%; display: flex;
      background: #111; border-top: 1px solid #333;
    }
    .tab-bar button {
      flex: 1; padding: 1rem; background: none; border: none;
      color: gold; font-weight: bold;
    }
    .page { display: none; padding: 1rem; padding-bottom: 70px; }
    .active { display: block; }
    input, button, select {
      width: 100%; padding: 0.6rem; margin: 0.5rem 0;
      background: #111; border: 1px solid gold; color: gold;
    }
    .chart-box { background: #111; padding: 1rem; border-radius: 8px; }
    canvas { background: #000; border: 1px solid gold; margin-top: 10px; }
    .buy-sell-box { background: #111; border-radius: 8px; padding: 1rem; margin-top: 1rem; }
    .notice { background: green; color: #fff; padding: 0.5rem; text-align: center; display: none; }
  </style>
</head>
<body>
  <h2 style="text-align:center;background:#111;padding:1rem;">Elsa Market</h2>
  <div id="notice" class="notice"></div>

  <!-- Login Page -->
  <div id="loginPage" class="page active">
    <h3>Login or Register</h3>
    <input id="emailInput" placeholder="Email" type="email" />
    <input id="passwordInput" placeholder="Password" type="password" />
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
  </div>

  <!-- Home Page -->
  <div id="homePage" class="page">
    <h3>Welcome <span id="userEmail"></span></h3>
    <p>Balance: $<span id="balance">0.00</span></p>
    <p>Gold: <span id="goldCount">0</span> | Diamond: <span id="diamondCount">0</span> | SOL: <span id="solCount">0</span></p>
    <div class="chart-box">
      <h4>üìà Live Price Chart</h4>
      <canvas id="priceChart" height="120"></canvas>
    </div>
  </div>

  <!-- Market Page -->
  <div id="marketPage" class="page">
    <h3>Buy Commodities ($2 each)</h3>
    <div class="buy-sell-box">
      <button onclick="buy('gold')">Buy Gold</button>
      <button onclick="buy('diamond')">Buy Diamond</button>
      <button onclick="buy('sol')">Buy SOL</button>
    </div>
    <h3>Sell Commodities ($2.60)</h3>
    <div class="buy-sell-box">
      <button onclick="sell('gold')">Sell Gold</button>
      <button onclick="sell('diamond')">Sell Diamond</button>
      <button onclick="sell('sol')">Sell SOL</button>
    </div>
  </div>

  <!-- Wallet Page -->
  <div id="walletPage" class="page">
    <h3>Wallet</h3>
    <p>Balance: $<span id="walletBalance">0.00</span></p>
    <button onclick="deposit()">Deposit ‚Ç¶1000</button>
    <button onclick="withdraw()">Withdraw ($4 min)</button>
  </div>

  <!-- Profile Page -->
  <div id="profilePage" class="page">
    <h3>Profile</h3>
    <p>Email: <span id="profileEmail"></span></p>
    <p>User ID: <span id="profileUID"></span></p>
    <p>Referral Link:</p>
    <p id="refLink">https://yourapp.com/register?ref=UID</p>
    <p>Resell History:</p>
    <ul id="resellHistory"></ul>
    <p><strong>Verification:</strong> <span id="verifyStatus">Not Verified</span></p>
  </div>

  <!-- Tab Bar -->
  <div class="tab-bar">
    <button onclick="switchPage('homePage')">üè† Home</button>
    <button onclick="switchPage('marketPage')">üíπ Market</button>
    <button onclick="switchPage('walletPage')">üíº Wallet</button>
    <button onclick="switchPage('profilePage')">üë§ Profile</button>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
    authDomain: "elsa-ab176.firebaseapp.com",
    projectId: "elsa-ab176",
    storageBucket: "elsa-ab176.firebasestorage.app",
    messagingSenderId: "850786583459",
    appId: "1:850786583459:android:5710287d8738f48e8e1016"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  function switchPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showNotice(text, color='green') {
    const n = document.getElementById('notice');
    n.innerText = text;
    n.style.background = color;
    n.style.display = 'block';
    setTimeout(() => n.style.display = 'none', 3000);
  }

  function register() {
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then((cred) => {
        db.collection('users').doc(cred.user.uid).set({
          email: email,
          balance: email === 'eluxxes@gmail.com' ? 10 : 0,
          gold: 0, diamond: 0, sol: 0, referrals: 0, verified: false,
          history: [], created: Date.now()
        });
        showNotice('Registered & logged in!');
        loadUser();
      })
      .catch(e => showNotice(e.message, 'red'));
  }

  function login() {
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        showNotice('Logged in!');
        loadUser();
      })
      .catch(e => showNotice(e.message, 'red'));
  }

  function loadUser() {
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        switchPage('homePage');
        db.collection('users').doc(user.uid).onSnapshot(doc => {
          const data = doc.data();
          document.getElementById('userEmail').innerText = data.email;
          document.getElementById('balance').innerText = data.balance.toFixed(2);
          document.getElementById('walletBalance').innerText = data.balance.toFixed(2);
          document.getElementById('goldCount').innerText = data.gold;
          document.getElementById('diamondCount').innerText = data.diamond;
          document.getElementById('solCount').innerText = data.sol;
          document.getElementById('profileEmail').innerText = data.email;
          document.getElementById('profileUID').innerText = user.uid;
          document.getElementById('refLink').innerText = `https://yourapp.com/register?ref=${user.uid}`;
          document.getElementById('verifyStatus').innerText = data.verified ? '‚úÖ Verified' : '‚ùå Not Verified';
          document.getElementById('resellHistory').innerHTML = data.history.map(h => `<li>${h}</li>`).join('');
        });
      }
    });
  }

  function buy(type) {
    const ref = db.collection('users').doc(currentUser.uid);
    db.runTransaction(async t => {
      const doc = await t.get(ref);
      const data = doc.data();
      if (data.balance < 2) throw new Error('Insufficient funds');
      t.update(ref, {
        balance: data.balance - 2,
        [type]: data[type] + 1
      });
    }).then(() => showNotice(`Bought 1 ${type}`)).catch(e => showNotice(e.message, 'red'));
  }

  function sell(type) {
    const ref = db.collection('users').doc(currentUser.uid);
    db.runTransaction(async t => {
      const doc = await t.get(ref);
      const data = doc.data();
      if (!data.verified) throw new Error('Only verified users can sell');
      if (data[type] < 1) throw new Error(`No ${type} to sell`);
      t.update(ref, {
        balance: data.balance + 2.45,
        [type]: data[type] - 1,
        history: [...data.history, `Sold 1 ${type} for $2.45`]
      });
    }).then(() => showNotice(`Sold 1 ${type}`)).catch(e => showNotice(e.message, 'red'));
  }

  function deposit() {
    window.open('https://paystack.com/buy/lilzok-vjmgrv', '_blank');
  }

  function withdraw() {
    alert('Withdrawal submitted. Admin will process if above $4.');
  }

  // Chart setup
  const ctx = document.getElementById('priceChart').getContext('2d');
  const priceChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Commodity Price',
        data: [],
        borderColor: 'gold',
        backgroundColor: 'rgba(255,215,0,0.1)',
        fill: true
      }]
    },
    options: {
      responsive: true,
      animation: false,
      scales: { y: { beginAtZero: true } }
    }
  });

  function loadChartLoop() {
    setInterval(() => {
      const price = (Math.random() * 0.5 + 2).toFixed(2);
      const now = new Date().toLocaleTimeString();
      if (priceChart.data.labels.length > 20) {
        priceChart.data.labels.shift();
        priceChart.data.datasets[0].data.shift();
      }
      priceChart.data.labels.push(now);
      priceChart.data.datasets[0].data.push(price);
      priceChart.update();
    }, 5000);
  }

  loadChartLoop();
  loadUser();
</script>
</body>
</html>
