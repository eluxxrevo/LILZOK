<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elsa App</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #000, #111);
      color: gold;
      margin: 0; padding: 0;
    }
    header { text-align: center; padding: 1rem; font-size: 1.5rem; border-bottom: 1px solid gold; }
    .tabbar {
      position: fixed; bottom: 0; width: 100%; display: flex; background: black;
    }
    .tabbar div {
      flex: 1; text-align: center; padding: 1rem; border-top: 1px solid gold; cursor: pointer;
    }
    .section { display: none; padding-bottom: 6rem; }
    .active { display: block; }
    button, input {
      padding: 10px; margin: 5px; font-size: 1rem;
    }
    canvas { background: #222; border: 1px solid gold; margin-top: 1rem; }
  </style>
</head>
<body>
  <header>Elsa Market</header>
  <div id="loginSection" class="section active">
    <h2>Login or Register</h2>
    <input id="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
  </div>
  <div id="mainSection" class="section">
    <h2>Welcome <span id="userEmail"></span></h2>
    <p>Balance: $<span id="balance">0.00</span></p>
    <div id="market" class="subsection">
      <h3>Market (Buy @ $2)</h3>
      <button onclick="buy('Gold')">Buy Gold</button>
      <button onclick="buy('Diamond')">Buy Diamond</button>
      <button onclick="buy('SOL')">Buy SOL</button>
      <h4>Sell for $2.60 (Verified only)</h4>
      <button onclick="sell('Gold')">Sell Gold</button>
      <button onclick="sell('Diamond')">Sell Diamond</button>
      <button onclick="sell('SOL')">Sell SOL</button>
      <canvas id="chart" width="300" height="150"></canvas>
    </div>
    <div id="referral" class="subsection">
      <h3>Your Referral Code:</h3>
      <p id="refCode"></p>
    </div>
    <div id="earn" class="subsection">
      <h3>Upload ID to Verify</h3>
      <input id="idUrl" placeholder="Paste ID Image URL"><br>
      <button onclick="uploadID()">Submit</button>
      <p id="verifyStatus"></p>
    </div>
    <div id="wallet" class="subsection">
      <h3>Wallet</h3>
      <button onclick="deposit()">Deposit</button>
      <button onclick="withdraw()">Withdraw</button>
    </div>
    <div class="tabbar">
      <div onclick="showTab('market')">Market</div>
      <div onclick="showTab('referral')">Referral</div>
      <div onclick="showTab('earn')">Earn</div>
      <div onclick="showTab('wallet')">Wallet</div>
    </div>
  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
      authDomain: "elsa-ab176.firebaseapp.com",
      projectId: "elsa-ab176",
      storageBucket: "elsa-ab176.firebasestorage.app",
      messagingSenderId: "850786583459",
      appId: "1:850786583459:android:5710287d8738f48e8e1016"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser, chartInstance;

    function register() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, pass).then(cred => {
        const defaultBalance = email === "eluxxes@gmail.com" ? 10 : 0;
        return db.collection("users").doc(cred.user.uid).set({
          email: email,
          balance: defaultBalance,
          verified: false,
          referrals: 0,
          earnings: 0,
          id_uploaded: false,
          uid: cred.user.uid
        });
      }).then(() => {
        alert("Registered and logged in");
      });
    }

    function login() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, pass).then(cred => {
        currentUser = cred.user;
        loadUser();
      });
    }

    function loadUser() {
      db.collection("users").doc(currentUser.uid).onSnapshot(doc => {
        const data = doc.data();
        document.getElementById("userEmail").innerText = data.email;
        document.getElementById("balance").innerText = data.balance.toFixed(2);
        document.getElementById("refCode").innerText = currentUser.uid;
        document.getElementById("verifyStatus").innerText = data.verified ? "âœ” Verified" : "Not Verified";
        document.getElementById("loginSection").classList.remove("active");
        document.getElementById("mainSection").classList.add("active");
      });

      db.collection("settings").doc("prices").onSnapshot(doc => {
        const data = doc.data();
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(document.getElementById("chart"), {
          type: 'bar',
          data: {
            labels: Object.keys(data),
            datasets: [{
              label: 'Prices',
              data: Object.values(data),
              backgroundColor: ["gold", "deepskyblue", "limegreen"]
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false }, title: { display: true, text: 'Live Market Prices' } }
          }
        });
      });
    }

    function buy(item) {
      const uid = currentUser.uid;
      db.runTransaction(async t => {
        const ref = db.collection("users").doc(uid);
        const doc = await t.get(ref);
        let data = doc.data();
        if (data.balance >= 2) {
          t.update(ref, { balance: data.balance - 2 });
          alert(item + " purchased!");
        } else {
          alert("Insufficient balance");
        }
      });
    }

    function sell(item) {
      const uid = currentUser.uid;
      db.collection("users").doc(uid).get().then(doc => {
        const data = doc.data();
        if (!data.verified) return alert("You must be verified to resell.");
        const newBal = data.balance + 2.45;
        db.collection("users").doc(uid).update({ balance: newBal, earnings: data.earnings + 2.45 });
        alert("You sold " + item);
      });
    }

    function uploadID() {
      const idUrl = document.getElementById("idUrl").value;
      if (!idUrl) return alert("Please paste a valid ID image link");
      db.collection("users").doc(currentUser.uid).update({
        id_uploaded: true,
        id_url: idUrl,
        verified: true
      });
      alert("ID submitted. You're now verified!");
    }

    function deposit() {
      window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");
    }

    function withdraw() {
      const uid = currentUser.uid;
      db.collection("users").doc(uid).get().then(doc => {
        const data = doc.data();
        if (data.balance >= 4) {
          db.collection("users").doc(uid).update({ balance: data.balance - 4 });
          alert("Withdraw successful");
        } else {
          alert("Minimum withdraw is $4");
        }
      });
    }

    function showTab(id) {
      document.querySelectorAll('.subsection').forEach(s => s.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }
  </script></body>
</html>
