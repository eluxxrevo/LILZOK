<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGIMART - Buy & Sell Digital Books</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e0115f; /* Royal pink */
            --secondary: #ffffff; /* Royal white */
            --accent: #ff4d88;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border: #dee2e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, #a50e4b 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeOut 0.5s ease 3s forwards;
        }
        
        .logo-animation {
            font-size: 5rem;
            font-weight: 800;
            color: var(--secondary);
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: pulse 1.5s infinite;
        }
        
        .splash-subtitle {
            color: var(--secondary);
            font-size: 1.5rem;
            margin-top: 1rem;
            opacity: 0.9;
            animation: fadeIn 1s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }

        /* Auth Container */
        #auth-container {
            display: none;
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--secondary);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .auth-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .auth-subtitle {
            color: var(--gray);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            margin-bottom: -2px;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(224, 17, 95, 0.1);
        }
        
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
        }
        
        .btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        /* App Container */
        #app-container {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 0;
            margin-bottom: 1rem;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        
        .app-logo i {
            margin-right: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .wallet-balance {
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            font-weight: 600;
        }
        
        .wallet-balance span {
            color: var(--primary);
        }
        
        /* Navigation */
        .app-nav {
            display: flex;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray);
        }
        
        .nav-item.active {
            background: var(--primary);
            color: white;
        }
        
        .nav-item i {
            margin-right: 8px;
        }
        
        /* Page Content */
        .page-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        
        .page-content.active {
            display: block;
        }
        
        .page-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Book Store */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }
        
        .book-card {
            background: var(--light);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .book-image {
            height: 200px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        
        .book-info {
            padding: 1.5rem;
        }
        
        .book-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .book-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .book-price {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .book-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        /* User Profile with MiniPay Integration */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .profile-info h2 {
            margin-bottom: 0.5rem;
        }
        
        .seller-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 30px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        /* MiniPay Wallet Section Styles */
        .wallet-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 0.5rem;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .btn-copy {
            background: rgba(224, 17, 95, 0.1);
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .btn-copy:hover {
            background: rgba(224, 17, 95, 0.2);
        }

        .wallet-address {
            background: var(--light);
            padding: 1rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        .wallet-address span {
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }

        .instruction-steps {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border: 1px solid var(--border);
        }

        .instruction-steps h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .instruction-steps ol {
            padding-left: 1.5rem;
        }

        .instruction-steps li {
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        .instruction-steps strong {
            color: var(--primary);
            font-weight: 700;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .stat-card {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .transaction-history {
            margin-top: 2rem;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-amount.positive {
            color: var(--success);
            font-weight: 700;
        }
        
        .transaction-amount.negative {
            color: var(--danger);
            font-weight: 700;
        }
        
        /* Deposit Instructions */
        .deposit-instructions {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border: 1px solid var(--border);
        }
        
        .deposit-instructions h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .deposit-instructions ol {
            padding-left: 1.5rem;
        }
        
        .deposit-instructions li {
            margin-bottom: 0.8rem;
        }
        
        .highlight-box {
            background: rgba(224, 17, 95, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-nav {
                flex-direction: column;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-animation {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen (3 seconds only) -->
    <div id="splash-screen">
        <div class="logo-animation">
            DIGIMART
        </div>
        <div class="splash-subtitle">
            Your Digital Book Marketplace
        </div>
    </div>
    
    <!-- Auth Container -->
    <div id="auth-container">
        <div class="auth-header">
            <h1 class="auth-title">DIGIMART</h1>
            <p class="auth-subtitle">Buy and sell books with ease</p>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" data-tab="login">Login</div>
            <div class="auth-tab" data-tab="register">Register</div>
        </div>
        
        <div id="login-form" class="auth-form active">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="login-email" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-control" id="login-password" placeholder="Enter your password">
            </div>
            <button class="btn" id="login-btn">Login</button>
            <p style="text-align: center; margin-top: 1rem; color: var(--gray);">
                Forgot password? <a href="#" style="color: var(--primary);">Reset here</a>
            </p>
        </div>
        
        <div id="register-form" class="auth-form">
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" id="register-name" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="register-email" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-control" id="register-password" placeholder="Create a password">
            </div>
            <div class="form-group">
                <label class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="register-confirm" placeholder="Confirm your password">
            </div>
            <div class="form-group">
                <label class="form-label">MiniPay Phone Number</label>
                <input type="tel" class="form-control" id="minipay-phone" placeholder="Enter phone number linked to your MiniPay wallet">
                <small class="form-text" style="color: var(--gray);">This will be used to receive payments</small>
            </div>
            <div class="form-group">
                <label class="form-label">Country</label>
                <select class="form-control" id="register-country">
                    <option value="">Select your country</option>
                    <option value="NG">Nigeria</option>
                    <option value="US">United States</option>
                    <option value="UK">United Kingdom</option>
                    <option value="EU">European Union</option>
                </select>
            </div>
            <button class="btn" id="register-btn">Create Account</button>
        </div>
    </div>
    
    <!-- App Container -->
    <div id="app-container">
        <!-- Header -->
        <header class="app-header">
            <a href="#" class="app-logo">
                <i class="fas fa-book"></i>
                DIGIMART
            </a>
            <div class="user-info">
                <div class="wallet-balance">
                    Balance: <span id="balance-amount">$0.00</span>
                </div>
                <div class="user-avatar" id="user-avatar">
                    DM
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="app-nav">
            <div class="nav-item active" data-page="store">
                <i class="fas fa-store"></i> Book Store
            </div>
            <div class="nav-item" data-page="upload">
                <i class="fas fa-cloud-upload-alt"></i> Upload
            </div>
            <div class="nav-item" data-page="profile">
                <i class="fas fa-user"></i> Profile
            </div>
        </nav>
        
        <!-- Book Store Page -->
        <div id="store-page" class="page-content active">
            <h2 class="page-title">
                <i class="fas fa-book-open"></i> Book Marketplace
            </h2>
            
            <div class="books-grid" id="books-grid">
                <!-- Books will be loaded dynamically -->
                <div class="spinner"></div>
            </div>
        </div>
        
        <!-- Upload Page -->
        <div id="upload-page" class="page-content">
            <h2 class="page-title">
                <i class="fas fa-cloud-upload-alt"></i> Upload Your Book
            </h2>
            
            <div class="form-group">
                <label class="form-label">Book Title</label>
                <input type="text" class="form-control" id="book-title" placeholder="Enter book title">
            </div>
            
            <div class="form-group">
                <label class="form-label">Book Description</label>
                <textarea class="form-control" id="book-description" rows="4" placeholder="Describe your book"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Book Category</label>
                <select class="form-control" id="book-category">
                    <option value="">Select category</option>
                    <option value="technology">Technology</option>
                    <option value="fiction">Fiction</option>
                    <option value="business">Business</option>
                    <option value="education">Education</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Upload PDF File</label>
                <div style="border: 2px dashed var(--border); border-radius: 10px; padding: 2rem; text-align: center;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--gray); margin-bottom: 1rem;"></i>
                    <p>Drag & drop your PDF file here</p>
                    <p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.5rem;">or</p>
                    <input type="file" id="book-file" accept=".pdf" style="display: none;">
                    <button class="btn btn-outline" style="margin-top: 1rem; width: auto;" onclick="document.getElementById('book-file').click()">
                        Browse Files
                    </button>
                    <div id="file-name" style="margin-top: 1rem; font-size: 0.9rem;"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Set Price (min $1)</label>
                <input type="number" class="form-control" id="book-price" value="1.99" min="1" step="0.01">
            </div>
            
            <button class="btn" id="publish-btn">Publish Book</button>
        </div>
        
        <!-- Profile Page -->
        <div id="profile-page" class="page-content">
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar">
                    DM
                </div>
                <div class="profile-info">
                    <h2 id="profile-name">DIGIMART</h2>
                    <p id="profile-email">admin@digimart.com</p>
                    <div class="wallet-info">
                        <i class="fas fa-mobile-alt"></i> 
                        <span id="minipay-number">08038684515</span>
                        <button class="btn-copy" onclick="copyMiniPayNumber()">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                    <div class="seller-badge" id="seller-badge">
                        <i class="fas fa-check-circle"></i> Verified Seller
                    </div>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-value" id="balance-display">$0.00</div>
                    <div class="stat-label">Current Balance</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-earnings">$0.00</div>
                    <div class="stat-label">Total Earnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="books-sold">0</div>
                    <div class="stat-label">Books Sold</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="books-purchased">0</div>
                    <div class="stat-label">Books Purchased</div>
                </div>
            </div>
            
            <div class="wallet-actions">
                <h3 class="page-title">
                    <i class="fas fa-wallet"></i> MiniPay Wallet
                </h3>
                
                <!-- Deposit Section -->
                <div class="deposit-instructions">
                    <h4><i class="fas fa-upload"></i> Deposit Funds via MiniPay</h4>
                    <div class="highlight-box">
                        <p><strong>Send to this MiniPay number:</strong></p>
                        <h3 style="color: var(--primary); margin: 0.5rem 0;">08038684515</h3>
                        <button class="btn-copy" onclick="copyMiniPayNumber()" style="display: inline-flex; align-items: center;">
                            <i class="far fa-copy"></i> Copy Number
                        </button>
                    </div>
                    <ol>
                        <li>Open your <strong>MiniPay app</strong></li>
                        <li>Select <strong>"Send Money"</strong></li>
                        <li>Enter <strong>08038684515</strong> as recipient</li>
                        <li>Enter the amount you wish to deposit (minimum $2)</li>
                        <li>Complete the transaction</li>
                        <li>Your balance will update automatically after confirmation (usually within 2 minutes)</li>
                    </ol>
                    <button class="btn" onclick="checkBalance()" style="margin-top: 1rem;">
                        <i class="fas fa-sync-alt"></i> Refresh Balance
                    </button>
                </div>
                
                <!-- Withdraw Section -->
                <div class="instruction-steps">
                    <h4><i class="fas fa-download"></i> Withdraw Funds</h4>
                    <p>Withdrawals require a minimum of $2 and must be sent to a MiniPay account.</p>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn" style="flex: 1;" onclick="withdrawFunds()">
                            <i class="fas fa-download"></i> Withdraw Now
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Transaction History -->
            <div class="transaction-history">
                <h3 class="page-title" style="margin-top: 2rem;">
                    <i class="fas fa-history"></i> Transaction History
                </h3>
                <div id="transaction-list">
                    <!-- Transactions will appear here dynamically -->
                    <div class="transaction-item empty-state">
                        <div>No transactions yet</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <p>© 2023 DIGIMART - Your Digital Book Marketplace</p>
            <p>All rights reserved. Prices in USD and EUR based on your location.</p>
        </footer>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            MINIPAY_NUMBER: "08038684515",
            API_BASE_URL: "https://api.digimart.com/v1",
            MIN_DEPOSIT: 2.00,
            MIN_WITHDRAWAL: 2.00,
            VERIFICATION_FEE: 6.00
        };
        
        // App State
        let currentUser = null;
        let authToken = null;
        let books = [];
        let transactions = [];
        
        // DOM Elements
        const elements = {
            splashScreen: document.getElementById('splash-screen'),
            authContainer: document.getElementById('auth-container'),
            appContainer: document.getElementById('app-container'),
            loginForm: document.getElementById('login-form'),
            registerForm: document.getElementById('register-form'),
            loginBtn: document.getElementById('login-btn'),
            registerBtn: document.getElementById('register-btn'),
            booksGrid: document.getElementById('books-grid'),
            transactionList: document.getElementById('transaction-list'),
            balanceDisplay: document.getElementById('balance-display'),
            totalEarnings: document.getElementById('total-earnings'),
            booksSold: document.getElementById('books-sold'),
            booksPurchased: document.getElementById('books-purchased'),
            profileName: document.getElementById('profile-name'),
            profileEmail: document.getElementById('profile-email'),
            profileAvatar: document.getElementById('profile-avatar'),
            userAvatar: document.getElementById('user-avatar'),
            balanceAmount: document.getElementById('balance-amount')
        };
        
        // Initialize the app when splash screen ends
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const session = localStorage.getItem('digimartSession');
                if (session) {
                    try {
                        const { user, token } = JSON.parse(session);
                        currentUser = user;
                        authToken = token;
                        loadAppData();
                        elements.appContainer.style.display = 'block';
                    } catch (e) {
                        console.error("Session parse error:", e);
                        localStorage.removeItem('digimartSession');
                        elements.authContainer.style.display = 'block';
                    }
                } else {
                    elements.authContainer.style.display = 'block';
                }
            }, 3000); // 3 seconds splash screen
            
            // Set up event listeners
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Auth tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-form`).classList.add('active');
                });
            });
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
                    item.classList.add('active');
                    document.getElementById(`${item.dataset.page}-page`).classList.add('active');
                });
            });
            
            // Login
            elements.loginBtn.addEventListener('click', handleLogin);
            
            // Register
            elements.registerBtn.addEventListener('click', handleRegister);
            
            // File upload
            document.getElementById('book-file').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'No file selected';
                document.getElementById('file-name').textContent = fileName;
            });
            
            // Publish book
            document.getElementById('publish-btn').addEventListener('click', publishBook);
        }
        
        async function loadAppData() {
            try {
                // Load user data
                const userResponse = await fetch(`${CONFIG.API_BASE_URL}/users/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (userResponse.ok) {
                    currentUser = await userResponse.json();
                    updateUserProfile();
                }
                
                // Load books
                const booksResponse = await fetch(`${CONFIG.API_BASE_URL}/books`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (booksResponse.ok) {
                    books = await booksResponse.json();
                    renderBooks();
                }
                
                // Load transactions
                const transactionsResponse = await fetch(`${CONFIG.API_BASE_URL}/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (transactionsResponse.ok) {
                    transactions = await transactionsResponse.json();
                    renderTransactions();
                }
            } catch (error) {
                console.error("Data loading error:", error);
                showNotification("Error loading data. Please refresh.");
            }
        }
        
        function updateUserProfile() {
            if (!currentUser) return;
            
            // Update profile info
            elements.profileName.textContent = currentUser.name;
            elements.profileEmail.textContent = currentUser.email;
            elements.minipayNumber.textContent = currentUser.minipayNumber || CONFIG.MINIPAY_NUMBER;
            
            // Update avatar initials
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            elements.profileAvatar.textContent = initials;
            elements.userAvatar.textContent = initials;
            
            // Update balance
            elements.balanceDisplay.textContent = `$${currentUser.balance.toFixed(2)}`;
            elements.balanceAmount.textContent = `$${currentUser.balance.toFixed(2)}`;
            
            // Update stats
            elements.totalEarnings.textContent = `$${currentUser.totalEarnings?.toFixed(2) || '0.00'}`;
            elements.booksSold.textContent = currentUser.booksSold || '0';
            elements.booksPurchased.textContent = currentUser.booksPurchased || '0';
            
            // Update seller badge
            const sellerBadge = document.getElementById('seller-badge');
            if (currentUser.isVerifiedSeller) {
                sellerBadge.innerHTML = '<i class="fas fa-check-circle"></i> Verified Seller';
                sellerBadge.style.display = 'inline-block';
            } else {
                sellerBadge.innerHTML = `<i class="fas fa-lock"></i> <a href="#" onclick="verifySeller()">Verify as Seller ($${CONFIG.VERIFICATION_FEE})</a>`;
                sellerBadge.style.display = 'inline-block';
            }
        }
        
        function renderBooks() {
            if (!books.length) {
                elements.booksGrid.innerHTML = '<div class="empty-state">No books available</div>';
                return;
            }
            
            elements.booksGrid.innerHTML = books.map(book => `
                <div class="book-card" data-id="${book.id}">
                    <div class="book-image">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">${book.title}</h3>
                        <div class="book-meta">
                            <span>${book.pages} pages</span>
                            <span>${book.purchases} purchases</span>
                        </div>
                        <div class="book-price">$${book.price.toFixed(2)}</div>
                        <div class="book-actions">
                            <button class="btn btn-sm" onclick="previewBook('${book.id}')">Preview</button>
                            <button class="btn btn-sm btn-outline" onclick="buyBook('${book.id}')">Buy Now</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderTransactions() {
            if (!transactions.length) {
                elements.transactionList.innerHTML = `
                    <div class="transaction-item empty-state">
                        <div>No transactions yet</div>
                    </div>
                `;
                return;
            }
            
            elements.transactionList.innerHTML = transactions.map(tx => `
                <div class="transaction-item">
                    <div>
                        <div>${tx.description}</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">
                            ${new Date(tx.date).toLocaleString()}
                        </div>
                    </div>
                    <div class="transaction-amount ${tx.amount > 0 ? 'positive' : 'negative'}">
                        ${tx.amount > 0 ? '+' : ''}$${Math.abs(tx.amount).toFixed(2)}
                    </div>
                </div>
            `).join('');
        }
        
        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification("Please enter both email and password");
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Save session
                    currentUser = data.user;
                    authToken = data.token;
                    localStorage.setItem('digimartSession', JSON.stringify({ user: currentUser, token: authToken }));
                    
                    // Hide auth, show app
                    elements.authContainer.style.display = 'none';
                    elements.appContainer.style.display = 'block';
                    
                    // Load app data
                    loadAppData();
                } else {
                    showNotification(data.message || "Login failed");
                }
            } catch (error) {
                console.error("Login error:", error);
                showNotification("Network error. Please try again.");
            }
        }
        
        async function handleRegister() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            const phone = document.getElementById('minipay-phone').value;
            const country = document.getElementById('register-country').value;
            
            // Basic validation
            if (!name || !email || !password || !confirm || !phone || !country) {
                showNotification("Please fill all fields");
                return;
            }
            
            if (password !== confirm) {
                showNotification("Passwords don't match");
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        password,
                        minipayNumber: phone,
                        country
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification("Registration successful! Please login.");
                    document.querySelector('.auth-tab[data-tab="login"]').click();
                } else {
                    showNotification(data.message || "Registration failed");
                }
            } catch (error) {
                console.error("Registration error:", error);
                showNotification("Network error. Please try again.");
            }
        }
        
        async function verifySeller() {
            if (!confirm(`Verify as seller for $${CONFIG.VERIFICATION_FEE}? This will be deducted from your balance.`)) {
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/users/verify`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: CONFIG.VERIFICATION_FEE
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    updateUserProfile();
                    showNotification("You are now a verified seller!");
                } else {
                    showNotification(data.message || "Verification failed");
                }
            } catch (error) {
                console.error("Verification error:", error);
                showNotification("Error during verification");
            }
        }
        
        async function buyBook(bookId) {
            if (!confirm("Confirm purchase of this book?")) {
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/books/purchase`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ bookId })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    books = data.books;
                    transactions = data.transactions;
                    updateUserProfile();
                    renderBooks();
                    renderTransactions();
                    showNotification("Purchase successful! Book added to your library.");
                } else {
                    showNotification(data.message || "Purchase failed");
                }
            } catch (error) {
                console.error("Purchase error:", error);
                showNotification("Error during purchase");
            }
        }
        
        async function publishBook() {
            const title = document.getElementById('book-title').value;
            const description = document.getElementById('book-description').value;
            const category = document.getElementById('book-category').value;
            const price = parseFloat(document.getElementById('book-price').value);
            const file = document.getElementById('book-file').files[0];
            
            // Validation
            if (!title || !description || !category || !price || !file) {
                showNotification("Please fill all fields and upload a file");
                return;
            }
            
            if (price < 1) {
                showNotification("Minimum price is $1");
                return;
            }
            
            // Create form data
            const formData = new FormData();
            formData.append('title', title);
            formData.append('description', description);
            formData.append('category', category);
            formData.append('price', price);
            formData.append('file', file);
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/books`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}'
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    books = data.books;
                    renderBooks();
                    showNotification("Book published successfully!");
                    // Reset form
                    document.getElementById('upload-page').querySelectorAll('input, textarea, select').forEach(el => {
                        if (el.type !== 'button' && el.type !== 'submit') {
                            el.value = '';
                        }
                    });
                    document.getElementById('file-name').textContent = '';
                } else {
                    showNotification(data.message || "Publishing failed");
                }
            } catch (error) {
                console.error("Publish error:", error);
                showNotification("Error publishing book");
            }
        }
        
        async function checkBalance() {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/users/balance`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser.balance = data.balance;
                    updateUserProfile();
                    showNotification("Balance updated");
                } else {
                    showNotification("Error checking balance");
                }
            } catch (error) {
                console.error("Balance check error:", error);
                showNotification("Network error checking balance");
            }
        }
        
        async function withdrawFunds() {
            if (currentUser.balance < CONFIG.MIN_WITHDRAWAL) {
                showNotification(`You need at least $${CONFIG.MIN_WITHDRAWAL} to withdraw`);
                return;
            }
            
            const amount = parseFloat(prompt(`Enter amount to withdraw (minimum $${CONFIG.MIN_WITHDRAWAL}):`, CONFIG.MIN_WITHDRAWAL.toString()));
            
            if (isNaN(amount)) return;
            
            if (amount < CONFIG.MIN_WITHDRAWAL) {
                showNotification(`Minimum withdrawal is $${CONFIG.MIN_WITHDRAWAL}`);
                return;
            }
            
            if (amount > currentUser.balance) {
                showNotification("Insufficient balance");
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/transactions/withdraw`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ amount })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    transactions = data.transactions;
                    updateUserProfile();
                    renderTransactions();
                    showNotification(`$${amount.toFixed(2)} withdrawn to your MiniPay`);
                } else {
                    showNotification(data.message || "Withdrawal failed");
                }
            } catch (error) {
                console.error("Withdrawal error:", error);
                showNotification("Error processing withdrawal");
            }
        }
        
        function copyMiniPayNumber() {
            navigator.clipboard.writeText(CONFIG.MINIPAY_NUMBER)
                .then(() => {
                    showNotification("MiniPay number copied: " + CONFIG.MINIPAY_NUMBER);
                })
                .catch(err => {
                    prompt("Copy this MiniPay number:", CONFIG.MINIPAY_NUMBER);
                });
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = 'var(--primary)';
            notification.style.color = 'white';
            notification.style.padding = '1rem 2rem';
            notification.style.borderRadius = '8px';
            notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            notification.style.zIndex = '1000';
            notification.style.animation = 'fadeIn 0.3s ease';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
