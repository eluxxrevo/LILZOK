<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elsa - Live Market App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, black, #4b3621);
      color: gold;
    }
    header {
      padding: 1rem;
      text-align: center;
      font-weight: bold;
      font-size: 1.5rem;
      background: #111;
    }
    section {
      padding: 1rem;
      display: none;
    }
    section.active {
      display: block;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
    }
    .tabs button {
      flex: 1;
      background: none;
      border: none;
      color: gold;
      padding: 1rem;
      font-size: 1rem;
    }
    input, button {
      padding: 0.7rem;
      width: 100%;
      margin-top: 0.5rem;
      border: none;
      border-radius: 5px;
    }
    button {
      background: gold;
      color: black;
      font-weight: bold;
    }
    .notif {
      display: none;
      text-align: center;
      padding: 0.5rem;
      background: #222;
      color: white;
    }
  </style>
</head>
<body>
  <header>Elsa Commodity App</header>
  <div class="notif" id="notif"></div>  <section id="login" class="active">
    <h2>Login</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p>New user? <a href="#" onclick="show('register')">Register</a></p>
  </section>  <section id="register">
    <h2>Register</h2>
    <input id="regEmail" placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">
    <button onclick="register()">Register</button>
    <p>Already have an account? <a href="#" onclick="show('login')">Login</a></p>
  </section>  <section id="market">
    <h2>Live Commodity Chart</h2>
    <canvas id="liveChart"></canvas>
    <h3>Current Price: $<span id="priceNow">2.00</span></h3>
    <button onclick="buyCommodity()">Buy at $2</button>
    <button onclick="sellCommodity()">Sell at $2.60</button>
  </section>  <section id="wallet">
    <h2>Your Wallet</h2>
    <p>Email: <span id="userEmail"></span></p>
    <p>Balance: $<span id="userBalance"></span></p>
    <p>Status: <span id="verifyStatus"></span></p>
    <button onclick="deposit()">Deposit</button>
    <button onclick="withdraw()">Withdraw</button>
    <button onclick="verify()">Verify ($1.50)</button>
  </section>  <div class="tabs" id="navTabs" style="display: none">
    <button onclick="navigate('market')">Market</button>
    <button onclick="navigate('wallet')">Wallet</button>
  </div>  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js';
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged
    } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js';
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      collection,
      addDoc,
      onSnapshot,
      increment
    } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
      authDomain: "elsa-ab176.firebaseapp.com",
      projectId: "elsa-ab176",
      storageBucket: "elsa-ab176.appspot.com",
      messagingSenderId: "850786583459",
      appId: "1:850786583459:android:5710287d8738f48e8e1016"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const $ = id => document.getElementById(id);
    const notify = msg => {
      $("notif").innerText = msg;
      $("notif").style.display = 'block';
      setTimeout(() => $("notif").style.display = 'none', 3000);
    };

    function show(page) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      $(page).classList.add('active');
    }

    function navigate(page) {
      show(page);
    }

    window.register = async () => {
      const email = $("regEmail").value;
      const password = $("regPassword").value;
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, "users", userCred.user.uid), {
        email,
        balance: email === "eluxxes@gmail.com" ? 10 : 0,
        verified: false
      });
    };

    window.login = async () => {
      const email = $("loginEmail").value;
      const password = $("loginPassword").value;
      const res = await signInWithEmailAndPassword(auth, email, password).catch(e => notify("Login Failed: " + e.message));
      if (res) initUser(res.user);
    };

    onAuthStateChanged(auth, user => { if (user) initUser(user); });

    async function initUser(user) {
      show('market');
      $("navTabs").style.display = 'flex';
      const snap = await getDoc(doc(db, "users", user.uid));
      const d = snap.data();
      $("userEmail").innerText = d.email;
      $("userBalance").innerText = d.balance.toFixed(2);
      $("verifyStatus").innerText = d.verified ? "Verified ✅" : "Not Verified ❌";
    }

    window.deposit = () => window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");

    window.verify = async () => {
      const user = auth.currentUser;
      const snap = await getDoc(doc(db, "users", user.uid));
      const bal = snap.data().balance;
      if (bal >= 1.5) {
        await updateDoc(doc(db, "users", user.uid), {
          verified: true,
          balance: bal - 1.5
        });
        notify("Verified successfully.");
      } else {
        notify("Insufficient funds. Please deposit.");
      }
    };

    window.withdraw = async () => {
      const user = auth.currentUser;
      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.data().balance >= 4) {
        await updateDoc(doc(db, "users", user.uid), { balance: snap.data().balance - 4 });
        notify("Withdrawal initiated.");
      } else {
        notify("Insufficient balance to withdraw.");
      }
    };

    window.buyCommodity = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (snap.data().balance >= 2) {
        await updateDoc(ref, { balance: snap.data().balance - 2 });
        await addDoc(collection(db, "resales"), {
          uid: user.uid,
          price: 2.60,
          time: Date.now()
        });
        notify("Purchase complete.");
      } else {
        notify("Insufficient funds.");
      }
    };

    window.sellCommodity = async () => {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (snap.data().verified) {
        await updateDoc(ref, { balance: snap.data().balance + 2.60 });
        notify("Sold for $2.60");
      } else {
        notify("You must verify to sell.");
      }
    };

    const chart = new Chart($("liveChart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Price',
          borderColor: 'gold',
          data: [],
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { display: false },
          y: { beginAtZero: false }
        }
      }
    });

    onSnapshot(collection(db, "resales"), snapshot => {
      const prices = snapshot.docs.map(doc => doc.data().price);
      chart.data.labels = prices.map((_, i) => i);
      chart.data.datasets[0].data = prices;
      chart.update();
      $("priceNow").innerText = prices[prices.length - 1]?.toFixed(2) || '2.00';
    });
  </script></body>
</html>
