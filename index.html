<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lilzok - Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body { background: #000; color: #FFD700; font-family: sans-serif; margin: 0; padding: 2rem; }
    .user-card { border: 1px solid #FFD700; background: #111; padding: 1rem; margin-bottom: 1rem; }
    .btn { padding: 0.4rem 0.8rem; border: none; background: #FFD700; color: #000; cursor: pointer; margin: 0.5rem 0.5rem 0 0; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .filters, .summary, .search-bar { text-align: center; margin-bottom: 1rem; }
    input[type="text"], input[type="email"], input[type="password"] { padding: 0.5rem; width: 60%; max-width: 400px; }
    .edit-prices { background: #111; border: 1px solid #FFD700; padding: 1rem; margin: 2rem 0; }
    .edit-prices input { width: 60px; padding: 0.3rem; margin-right: 1rem; }
    @media (max-width: 600px) {
      body { padding: 1rem; }
      .user-card { font-size: 0.9rem; }
      img { max-width: 100%; height: auto; }
    }
  </style>
</head>
<body>
  <h1>üëë Admin Panel - Lilzok</h1>
  <div id="adminLogin">
    <input type="email" id="adminEmail" placeholder="Admin Email"><br><br>
    <input type="password" id="adminPassword" placeholder="Password"><br><br>
    <button class="btn" onclick="adminLogin()">Login as Admin</button>
    <p id="loginStatus"></p>
  </div>  <div id="adminPanel" style="display: none;">
    <div class="summary">
      <strong>Total Users:</strong> <span id="totalUsers">0</span> |
      <strong>Total Earnings:</strong> $<span id="totalEarnings">0.00</span>
      <button class="btn" onclick="logoutAdmin()">Logout</button>
    </div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by email" oninput="searchUser(this.value)" />
    </div>
    <div class="filters">
      <button class="btn" onclick="filterUsers('all')">All Users</button>
      <button class="btn" onclick="filterUsers('verified')">Verified Only</button>
      <button class="btn" onclick="filterUsers('pending')">Pending Only</button>
      <button class="btn" onclick="exportCSV()">Export CSV</button>
    </div><div class="edit-prices">
  <h3>üíπ Commodity Price Editor</h3>
  <div>
    <label>Gold: $</label><input id="goldPrice" type="number" step="0.01" />
    <label>Diamond: $</label><input id="diamondPrice" type="number" step="0.01" />
    <label>SOL: $</label><input id="solPrice" type="number" step="0.01" />
    <button class="btn" onclick="updatePrices()">Update Prices</button>
  </div>
</div>

<div id="userList"></div>

  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBoWx2QyoiJwxD1PvHw7Xib7rAlRYTfhCc",
      authDomain: "lilzok.firebaseapp.com",
      projectId: "lilzok",
      storageBucket: "lilzok.firebasestorage.app",
      messagingSenderId: "185365580013",
      appId: "1:185365580013:android:f33fd17ea7264edd6ba4e4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const adminEmails = ["admin@lilzok.com", "eluxxes@gmail.com"];
    let usersData = [];

    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;

      auth.signInWithEmailAndPassword(email, password)
        .then(user => {
          if (!adminEmails.includes(email)) {
            document.getElementById("loginStatus").innerText = "Access denied. Not an admin.";
            auth.signOut();
            return;
          }
          document.getElementById("adminLogin").style.display = "none";
          document.getElementById("adminPanel").style.display = "block";
          listenToUsers();
        })
        .catch(err => {
          document.getElementById("loginStatus").innerText = err.message;
        });
    }

    function autoLoginIfAdmin() {
      document.getElementById('adminEmail').value = "eluxxes@gmail.com";
      document.getElementById('adminPassword').value = "Ebube@123";
      adminLogin();
    }

    function shortcutListener() {
      window.addEventListener("keydown", function (e) {
        if (e.shiftKey && e.key.toLowerCase() === 'a') {
          autoLoginIfAdmin();
        }
      });
    }

    window.onload = () => {
      shortcutListener();
      if (window.location.pathname.includes("admin")) autoLoginIfAdmin();
    };

    function logoutAdmin() {
      auth.signOut().then(() => location.reload());
    }

    function listenToUsers() {
      db.collection("users").onSnapshot(snapshot => {
        usersData = [];
        snapshot.forEach(doc => {
          usersData.push({ id: doc.id, ...doc.data() });
        });
        filterUsers("all");
      });
    }

    function renderUsers(data) {
      let html = "";
      let total = 0;
      let earnings = 0;
      data.forEach(u => {
        total++;
        earnings += Number(u.earnings || 0);
        html += `
          <div class="user-card">
            <strong>Email:</strong> ${u.name || 'Unknown'}<br>
            <strong>Balance:</strong> $${(u.balance || 0).toFixed(2)}<br>
            <strong>Earnings:</strong> $${(u.earnings || 0).toFixed(2)}<br>
            <strong>Referrals:</strong> ${u.referrals || 0}<br>
            <strong>Verified ID:</strong> ${u.id_uploaded ? '‚úÖ' : '‚ùå'}<br>
            ${u.id_url ? `<img src="${u.id_url}" alt="ID Image" width="200">` : ''}<br>
            <button class="btn" onclick="toggleVerify('${u.id}', ${u.id_uploaded ? 'false' : 'true'})">${u.id_uploaded ? '‚ùå Unverify' : '‚úÖ Verify'}</button>
            <button class="btn" onclick="deleteUser('${u.id}')">Delete</button>
          </div>
        `;
      });
      document.getElementById("totalUsers").textContent = total;
      document.getElementById("totalEarnings").textContent = earnings.toFixed(2);
      document.getElementById("userList").innerHTML = html;
    }

    function filterUsers(type) {
      let filtered = usersData;
      if (type === "verified") filtered = usersData.filter(u => u.id_uploaded);
      if (type === "pending") filtered = usersData.filter(u => !u.id_uploaded);
      renderUsers(filtered);
    }

    function searchUser(query) {
      const result = usersData.filter(u => (u.name || '').toLowerCase().includes(query.toLowerCase()));
      renderUsers(result);
    }

    function toggleVerify(uid, status) {
      db.collection("users").doc(uid).update({ id_uploaded: status });
    }

    function deleteUser(uid) {
      if (!confirm("Are you sure you want to delete this user?")) return;
      db.collection("users").doc(uid).delete();
    }

    function exportCSV() {
      let csv = "Email,Balance,Earnings,Referrals,Verified\n";
      usersData.forEach(u => {
        csv += `${u.name || 'Unknown'},${(u.balance || 0)},${(u.earnings || 0)},${(u.referrals || 0)},${u.id_uploaded ? 'Yes' : 'No'}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'lilzok_users.csv';
      link.click();
    }

    function updatePrices() {
      const gold = parseFloat(document.getElementById('goldPrice').value || 2).toFixed(2);
      const diamond = parseFloat(document.getElementById('diamondPrice').value || 2).toFixed(2);
      const sol = parseFloat(document.getElementById('solPrice').value || 2).toFixed(2);
      db.collection("settings").doc("prices").set({ gold, diamond, sol }, { merge: true })
        .then(() => alert("Prices updated!"));
    }
  </script></body>
</html>
