<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elsa Coin App - The Supreme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
  <!-- ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
      color: gold;
    }
    #animation {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      color: gold;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2em;
      z-index: 9999;
    }
    #app { display: none; }
    .tab { display: none; padding: 20px; }
    .tab.active { display: block; }
    .nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
    }
    .nav button {
      background: none;
      border: none;
      color: gold;
      font-size: 1.1em;
    }
    input, select {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }
    .hidden { display: none; }
    .notification {
      background: red;
      color: white;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    .chart-container {
      height: 400px;
    }
  </style>
</head>
<body>

<div id="animation">ğŸ”® The Supreme Elsa</div>

<div id="app">
  <div id="notification" class="notification"></div>

  <!-- Login Page -->
  <div class="tab active" id="login-tab">
    <h2>Login</h2>
    <input type="email" id="login-email" placeholder="Email">
    <input type="password" id="login-pass" placeholder="Password">
    <button onclick="login()">Login</button>
    <p>Don't have an account? <a href="#" onclick="switchTab('register-tab')">Register</a></p>
  </div>

  <!-- Register Page -->
  <div class="tab" id="register-tab">
    <h2>Register</h2>
    <input type="text" id="reg-name" placeholder="Full Name">
    <input type="email" id="reg-email" placeholder="Email">
    <input type="password" id="reg-pass" placeholder="Password">
    <input type="text" id="ref-code" placeholder="Referral Code (Optional)">
    <button onclick="register()">Register</button>
    <p>Already have an account? <a href="#" onclick="switchTab('login-tab')">Login</a></p>
  </div>

  <!-- Home / Chart -->
  <div class="tab" id="home-tab">
    <h2>ğŸ“ˆ Elsa Live Chart</h2>
    <div class="chart-container" id="chart"></div>
    <label>Buy Elsa ($):</label>
    <input type="number" id="buy-amount" placeholder="Min $2">
    <button onclick="buyElsa()">Buy</button>
    <br>
    <label>Resell Elsa ($):</label>
    <input type="number" id="sell-amount" placeholder="Only if verified">
    <button onclick="sellElsa()">Resell</button>
    <div id="comment-box">
      <h4>ğŸ’¬ Chat</h4>
      <input type="text" id="chat-msg" placeholder="Type comment">
      <button onclick="sendComment()">Send</button>
      <div id="chat-feed"></div>
    </div>
  </div>

  <!-- Profile -->
  <div class="tab" id="profile-tab">
    <h2>ğŸ‘¤ Profile</h2>
    <p id="profile-info"></p>
    <p>Referral Link: <span id="ref-link"></span></p>
    <p>Referrals: <span id="ref-count"></span> / 8</p>
    <p>Verification: <span id="verify-status"></span></p>
    <button onclick="verifyNormal()">Verify (Little Bird)</button>
    <button onclick="verifyLord()">Verify (Lord)</button>
    <h3>âš™ï¸ Settings</h3>
    <select id="theme-toggle" onchange="toggleTheme(this.value)">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Wallet / Referral -->
  <div class="tab" id="wallet-tab">
    <h2>ğŸ’¼ Wallet</h2>
    <p>Balance: <span id="wallet-balance">$0</span></p>
    <p>Elsa Coin: <span id="elsa-balance">0</span> ELSA</p>
    <button onclick="deposit()">Deposit</button>
    <button onclick="iPaid()">I have paid</button>
    <h4>Withdraw</h4>
    <input type="number" id="with-amount" placeholder="Amount">
    <select id="with-bank">
      <option>Opay</option><option>Kuda</option><option>Moniepoint</option><option>FirstBank</option>
    </select>
    <input type="text" id="with-num" placeholder="Wallet Number">
    <button onclick="withdraw()">Request Withdraw</button>
    <h4>ğŸ“œ Transaction History</h4>
    <div id="history"></div>
  </div>

  <!-- Leaderboard -->
  <div class="tab" id="leader-tab">
    <h2>ğŸ† Leaderboard</h2>
    <div id="leaderboard"></div>
  </div>

  <!-- Customer Support -->
  <div class="tab" id="support-tab">
    <h2>ğŸ“ Support</h2>
    <p>For help or questions, email: <b>eluxxes@gmail.com</b></p>
    <p>â— To use this app, you must be 18+</p>
    <h4>How Elsa Works:</h4>
    <ul>
      <li>1 Elsa = $2000</li>
      <li>Buy from $2 upward</li>
      <li>Resale only after 8 referrals</li>
      <li>Price changes by demand (auto)</li>
    </ul>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <button onclick="switchTab('home-tab')">ğŸ“ˆ</button>
    <button onclick="switchTab('wallet-tab')">ğŸ’¼</button>
    <button onclick="switchTab('profile-tab')">ğŸ‘¤</button>
    <button onclick="switchTab('leader-tab')">ğŸ†</button>
    <button onclick="switchTab('support-tab')">ğŸ“</button>
  </div>
</div>

<!-- Part 2 contains: Script logic (Firebase auth, wallet, chart, comments, leaderboard, etc.) -->
<script>
  setTimeout(() => {
    document.getElementById('animation').style.display = 'none';
    document.getElementById('app').style.display = 'block';
  }, 4000); // Show for 4s

  function switchTab(id) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showNotification(msg) {
    const el = document.getElementById('notification');
    el.innerText = msg;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 3000);
  }
</script>
<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyApuMISYyAXo7Xdxa_FAYDG-tHaU5vJA6A",
    authDomain: "elsa-809c1.firebaseapp.com",
    projectId: "elsa-809c1",
    storageBucket: "elsa-809c1.firebasestorage.app",
    messagingSenderId: "401983741723",
    appId: "1:401983741723:android:253c41bf6a9011d0483dbe"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;
  let pricePerElsa = 2000;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loadUser();
      switchTab('home-tab');
    }
  });

  function register() {
    const email = document.getElementById("reg-email").value;
    const pass = document.getElementById("reg-pass").value;
    const name = document.getElementById("reg-name").value;
    const ref = document.getElementById("ref-code").value;

    if (!email || !pass || !name) return showNotification("Fill all fields");

    auth.createUserWithEmailAndPassword(email, pass)
      .then(cred => {
        return db.collection("users").doc(cred.user.uid).set({
          name,
          email,
          balance: 0,
          elsa: 0,
          refBy: ref || "",
          referrals: 0,
          verified: false,
          lord: false,
          createdAt: Date.now()
        }).then(() => {
          if (ref) rewardReferrer(ref);
        });
      }).catch(e => showNotification(e.message));
  }

  function rewardReferrer(refEmail) {
    db.collection("users").where("email", "==", refEmail).get().then(snap => {
      snap.forEach(doc => {
        const refId = doc.id;
        const refData = doc.data();
        db.collection("users").doc(refId).update({
          referrals: (refData.referrals || 0) + 1
        });
      });
    });
  }

  function login() {
    const email = document.getElementById("login-email").value;
    const pass = document.getElementById("login-pass").value;

    auth.signInWithEmailAndPassword(email, pass)
      .then(() => showNotification("Welcome"))
      .catch(() => showNotification("Invalid login details"));
  }

  function logout() {
    auth.signOut().then(() => location.reload());
  }

  function loadUser() {
    db.collection("users").doc(currentUser.uid).onSnapshot(doc => {
      const data = doc.data();
      document.getElementById("profile-info").innerText = `Name: ${data.name}\nEmail: ${data.email}`;
      document.getElementById("wallet-balance").innerText = `$${data.balance?.toFixed(2)}`;
      document.getElementById("elsa-balance").innerText = data.elsa?.toFixed(4);
      document.getElementById("ref-link").innerText = `${location.href}?ref=${data.email}`;
      document.getElementById("ref-count").innerText = data.referrals || 0;
      document.getElementById("verify-status").innerText = data.verified ? "âœ… Verified" : "âŒ Not verified";

      if (currentUser.email === "eluxxes@gmail.com") {
        db.collection("users").doc(currentUser.uid).update({ elsa: 2000 });
      }

      loadTransactions();
      loadLeaderboard();
    });
  }

  function deposit() {
    window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");
  }

  function iPaid() {
    showNotification("Send payment proof to eluxxes@gmail.com");
  }

  function withdraw() {
    const amt = parseFloat(document.getElementById("with-amount").value);
    const bank = document.getElementById("with-bank").value;
    const num = document.getElementById("with-num").value;

    if (!amt || !bank || !num) return showNotification("Fill all fields");

    db.collection("withdrawals").add({
      uid: currentUser.uid,
      amount: amt,
      bank,
      number: num,
      status: "pending",
      time: Date.now()
    }).then(() => {
      showNotification("Request sent. Youâ€™ll be credited in 2 hrs.");
    });
  }

  function loadTransactions() {
    db.collection("withdrawals").where("uid", "==", currentUser.uid)
      .orderBy("time", "desc")
      .get().then(snap => {
        let html = '';
        snap.forEach(doc => {
          const d = doc.data();
          html += `<p>${d.amount} - ${d.bank} - ${d.status}</p>`;
        });
        document.getElementById("history").innerHTML = html || "No transactions.";
      });
  }

  function buyElsa() {
    const amt = parseFloat(document.getElementById("buy-amount").value);
    if (!amt || amt < 2) return showNotification("Min $2");
    const coins = amt / pricePerElsa;

    db.collection("users").doc(currentUser.uid).get().then(doc => {
      const user = doc.data();
      if (user.balance < amt) return showNotification("Insufficient funds");

      db.collection("users").doc(currentUser.uid).update({
        balance: user.balance - amt,
        elsa: user.elsa + coins
      });
      showNotification(`Bought ${coins.toFixed(4)} ELSA`);
    });
  }

  function sellElsa() {
    const amt = parseFloat(document.getElementById("sell-amount").value);
    if (!amt) return;
    const coins = amt / pricePerElsa;

    db.collection("users").doc(currentUser.uid).get().then(doc => {
      const user = doc.data();
      if (!user.verified) return showNotification("Verify first");
      if (user.elsa < coins) return showNotification("Insufficient Elsa");

      const credit = amt * 0.9;
      db.collection("users").doc(currentUser.uid).update({
        elsa: user.elsa - coins,
        balance: user.balance + credit
      });
      showNotification(`Sold ${coins.toFixed(4)} ELSA for $${credit.toFixed(2)}`);
    });
  }

  function sendComment() {
    const msg = document.getElementById("chat-msg").value;
    if (!msg) return;
    db.collection("chat").add({
      uid: currentUser.uid,
      message: msg,
      time: Date.now()
    });
    document.getElementById("chat-msg").value = '';
  }

  db.collection("chat").orderBy("time", "desc").limit(20).onSnapshot(snap => {
    let chat = '';
    snap.forEach(doc => {
      const d = doc.data();
      chat += `<p>${d.message}</p>`;
    });
    document.getElementById("chat-feed").innerHTML = chat;
  });

  function verifyNormal() {
    db.collection("users").doc(currentUser.uid).get().then(doc => {
      const user = doc.data();
      if (user.referrals < 8) return showNotification("Need 8 referrals");
      db.collection("users").doc(currentUser.uid).update({ verified: true });
      showNotification("Youâ€™re now verified to resell");
    });
  }

  function verifyLord() {
    db.collection("users").doc(currentUser.uid).get().then(doc => {
      const user = doc.data();
      if (user.referrals < 1000) return showNotification("Need 1000 referrals");
      db.collection("users").doc(currentUser.uid).update({ lord: true });
      showNotification("Youâ€™re now a verified LORD");
    });
  }

  function loadLeaderboard() {
    db.collection("users").orderBy("referrals", "desc").limit(10).get().then(snap => {
      let html = '';
      snap.forEach(doc => {
        const d = doc.data();
        html += `<p>${d.name} - ${d.referrals} referrals</p>`;
      });
      document.getElementById("leaderboard").innerHTML = html;
    });
  }

  function toggleTheme(theme) {
    document.body.style.background = theme === 'dark' ? '#000' : '#fff';
    document.body.style.color = theme === 'dark' ? 'gold' : '#000';
  }

  // Chart setup
  const chartOptions = {
    series: [{ name: "ELSA", data: [2000, 2020, 1990, 2040, 1980, 2050] }],
    chart: { type: 'candlestick', height: 350 },
    xaxis: { type: 'datetime' }
  };
  const chart = new ApexCharts(document.querySelector("#chart"), chartOptions);
  chart.render();
  setInterval(() => {
    const now = new Date().getTime();
    const random = Math.random() * 50;
    chart.updateSeries([{
      data: [...chartOptions.series[0].data.slice(-5), 2000 + random]
    }]);
  }, 4000);
</script>
