<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elsa Coin - The Supreme</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to bottom, #000000, #111111);
      color: #fff;
      overflow: hidden;
    }
    .splash {
      position: fixed;
      width: 100%;
      height: 100%;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
    }
    .splash h1 {
      font-size: 2.5em;
      color: gold;
    }
    .splash p {
      font-size: 1.2em;
      color: #aaa;
    }
    .hidden { display: none; }
    .tab-bar {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      background: #111;
      border-top: 1px solid #333;
    }
    .tab-bar button {
      flex: 1;
      padding: 10px;
      background: none;
      border: none;
      color: white;
      font-size: 14px;
    }
    .tab-bar button.active {
      color: gold;
    }
    .page {
      display: none;
      padding: 20px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }
    .page.active {
      display: block;
    }
    .login, .register {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 300px;
      margin: auto;
      margin-top: 20vh;
    }
    input, select {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: gold;
      color: #000;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    .chart-box {
      width: 100%;
      height: 70vh;
      background: #000;
      border: 1px solid #333;
      margin-bottom: 10px;
    }
    .action-box {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .tooltip {
      background: #222;
      color: #fff;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
      position: absolute;
      top: 5px;
      right: 5px;
    }
  </style>
</head>
<body>

<!-- Splash Animation -->
<div class="splash" id="splash">
  <h1>The Supreme</h1>
  <p>Loading Elsa Coin...</p>
</div>

<!-- Authentication -->
<div class="page active" id="languageSelect">
  <h2>Select Language</h2>
  <button onclick="nextPage('loginPage')">üá¨üáß English</button>
  <button onclick="nextPage('loginPage')">üá´üá∑ French</button>
</div>

<div class="page" id="loginPage">
  <h2>Login</h2>
  <form onsubmit="login(event)" class="login">
    <input type="email" id="loginEmail" placeholder="Email" required/>
    <input type="password" id="loginPass" placeholder="Password" required/>
    <button type="submit">Login</button>
    <button type="button" onclick="nextPage('registerPage')">Register</button>
    <p id="loginError" style="color:red;"></p>
  </form>
</div>

<div class="page" id="registerPage">
  <h2>Register</h2>
  <form onsubmit="register(event)" class="register">
    <input type="email" id="regEmail" placeholder="Email" required/>
    <input type="password" id="regPass" placeholder="Password" required/>
    <input type="text" id="refCode" placeholder="Referral Code (Optional)" />
    <button type="submit">Register</button>
    <button type="button" onclick="nextPage('loginPage')">Back to Login</button>
    <p id="regError" style="color:red;"></p>
  </form>
</div>

<!-- App Pages -->
<div class="page" id="chartPage">
  <h2>Elsa Market</h2>
  <div class="chart-box" id="liveChart">üìà Loading chart...</div>
  <div class="action-box">
    <button onclick="buyElsa()">Buy Elsa</button>
    <button onclick="sellElsa()">Sell Elsa</button>
  </div>
  <small>1 Elsa = $2000 | 20M Max Supply</small>
</div>

<div class="page" id="walletPage">
  <h2>Wallet</h2>
  <p><strong>Balance:</strong> $<span id="walletBalance">0.00</span></p>
  <p><strong>Elsa Owned:</strong> <span id="elsaBalance">0</span> ELSA</p>
  <button onclick="deposit()">Deposit</button>
  <button onclick="withdraw()">Withdraw</button>
  <h4>Transaction History</h4>
  <div id="txnHistory">None yet.</div>
</div>

<div class="page" id="profilePage">
  <h2>Profile</h2>
  <p><strong>Name:</strong> <span id="userName">-</span></p>
  <p><strong>Email:</strong> <span id="userEmail">-</span></p>
  <p><strong>Referral Link:</strong> <input id="refLink" readonly/></p>
  <p><strong>Referrals:</strong> <span id="refCount">0</span> / 8</p>
  <p><strong>Verified:</strong> <span id="verifiedBadge">‚ùå</span></p>
  <button onclick="logout()">Logout</button>
</div>

<div class="page" id="leaderboardPage">
  <h2>Leaderboard</h2>
  <p>üîù Most Referrals</p>
  <div id="topReferrals">Loading...</div>
  <p>üí∞ Top Earners</p>
  <div id="topEarners">Loading...</div>
</div>

<!-- Navigation Tabs -->
<div class="tab-bar" id="navBar" style="display:none;">
  <button onclick="showTab('chartPage')" class="active">üìà Home</button>
  <button onclick="showTab('walletPage')">üí≥ Wallet</button>
  <button onclick="showTab('profilePage')">üë§ Profile</button>
  <button onclick="showTab('leaderboardPage')">üèÜ Leaderboard</button>
</div>

<script>
  // Splash screen timer
  setTimeout(() => {
    document.getElementById('splash').style.display = 'none';
    document.getElementById('languageSelect').classList.add('active');
  }, 4000);

  function nextPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showTab(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
    Array.from(document.querySelectorAll('.tab-bar button')).find(b => b.textContent.includes(document.getElementById(id).querySelector('h2').textContent)).classList.add('active');
  }
</script>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyApuMISYyAXo7Xdxa_FAYDG-tHaU5vJA6A",
  authDomain: "elsa-809c1.firebaseapp.com",
  projectId: "elsa-809c1",
  storageBucket: "elsa-809c1.firebasestorage.app",
  messagingSenderId: "401983741723",
  appId: "1:401983741723:android:253c41bf6a9011d0483dbe"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

// Auth Functions
function login(e) {
  e.preventDefault();
  const email = loginEmail.value;
  const pass = loginPass.value;
  auth.signInWithEmailAndPassword(email, pass).then(user => {
    currentUser = user.user;
    afterLogin();
  }).catch(() => {
    loginError.textContent = "Invalid login details!";
    setTimeout(() => loginError.textContent = "", 3000);
  });
}

function register(e) {
  e.preventDefault();
  const email = regEmail.value;
  const pass = regPass.value;
  auth.createUserWithEmailAndPassword(email, pass).then(cred => {
    currentUser = cred.user;
    const refCode = refCodeInput.value || "";
    db.collection("users").doc(currentUser.uid).set({
      email,
      uid: currentUser.uid,
      balance: 0,
      elsa: 0,
      referrals: [],
      referredBy: refCode,
      verified: false,
      lord: false,
      history: [],
      timestamp: Date.now()
    });
    afterLogin();
  }).catch(() => {
    regError.textContent = "Email already in use!";
    setTimeout(() => regError.textContent = "", 3000);
  });
}

function afterLogin() {
  nextPage("chartPage");
  navBar.style.display = "flex";
  db.collection("users").doc(currentUser.uid).get().then(doc => {
    const data = doc.data();
    if (currentUser.email === "eluxxes@gmail.com") {
      db.collection("users").doc(currentUser.uid).update({ elsa: 2000 });
    }
    userEmail.textContent = data.email;
    walletBalance.textContent = (data.balance || 0).toFixed(2);
    elsaBalance.textContent = data.elsa || 0;
    refLink.value = `https://elsa.app?ref=${data.uid}`;
    refCount.textContent = (data.referrals || []).length;
    verifiedBadge.textContent = data.verified ? "‚úÖ" : "‚ùå";
    fetchChart();
    loadLeaderboard();
  });
}

function logout() {
  auth.signOut().then(() => location.reload());
}

// Buy/Sell Elsa
function buyElsa() {
  const usd = prompt("How much in USD? (Min $2)");
  const amount = parseFloat(usd);
  if (isNaN(amount) || amount < 2) return alert("Invalid amount");
  const elsa = amount / 2000;
  db.collection("users").doc(currentUser.uid).update({
    elsa: firebase.firestore.FieldValue.increment(elsa),
    balance: firebase.firestore.FieldValue.increment(-amount),
    history: firebase.firestore.FieldValue.arrayUnion({
      type: "buy",
      elsa,
      amount,
      date: Date.now()
    })
  }).then(() => alert("Elsa purchased!"));
}

function sellElsa() {
  db.collection("users").doc(currentUser.uid).get().then(doc => {
    const user = doc.data();
    if (!user.verified) return alert("Please verify first by referring 8 users.");
    const amount = prompt("How many Elsa to sell?");
    const sellAmt = parseFloat(amount);
    if (isNaN(sellAmt) || sellAmt <= 0 || sellAmt > user.elsa) return alert("Invalid amount");
    const value = sellAmt * 2000 * 0.9; // 10% fee
    db.collection("users").doc(currentUser.uid).update({
      elsa: firebase.firestore.FieldValue.increment(-sellAmt),
      balance: firebase.firestore.FieldValue.increment(value),
      history: firebase.firestore.FieldValue.arrayUnion({
        type: "resell",
        elsa: sellAmt,
        amount: value,
        date: Date.now()
      })
    }).then(() => alert("Resell successful!"));
  });
}

// Withdraw
function withdraw() {
  const amount = prompt("Amount to withdraw (min $5)");
  const bank = prompt("Bank (Opay, Kuda, FirstBank, etc)");
  const acc = prompt("Account Number");
  if (parseFloat(amount) < 5) return alert("Minimum is $5");
  db.collection("withdrawals").add({
    uid: currentUser.uid,
    amount: parseFloat(amount),
    bank,
    account: acc,
    status: "pending",
    date: Date.now()
  }).then(() => alert("Withdraw request sent. Processed within 2hrs."));
}

// Deposit
function deposit() {
  window.location.href = "https://paystack.com/buy/lilzok-vjmgrv";
}

// Chart (Candle simulation)
let chart;
function fetchChart() {
  const ctx = document.getElementById("liveChart");
  if (chart) chart.destroy();
  const prices = Array.from({ length: 30 }, () => 2000 + Math.random() * 50 - 25);
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: prices.map((_, i) => i + 1),
      datasets: [{
        label: "Elsa Price (USD)",
        data: prices,
        borderColor: "gold",
        backgroundColor: "rgba(255, 215, 0, 0.2)",
        fill: true
      }]
    },
    options: {
      responsive: true,
      animation: { duration: 1000 },
      plugins: { legend: { display: false } }
    }
  });
}

// Leaderboard
function loadLeaderboard() {
  db.collection("users").orderBy("balance", "desc").limit(5).get().then(snapshot => {
    topEarners.innerHTML = "";
    snapshot.forEach(doc => {
      topEarners.innerHTML += `<p>${doc.data().email} - $${(doc.data().balance || 0).toFixed(2)}</p>`;
    });
  });
  db.collection("users").orderBy("referrals.length", "desc").limit(5).get().then(snapshot => {
    topReferrals.innerHTML = "";
    snapshot.forEach(doc => {
      topReferrals.innerHTML += `<p>${doc.data().email} - ${doc.data().referrals?.length || 0} referrals</p>`;
    });
  });
}
</script>
</body>
</html>
