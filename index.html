<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lilzok App</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: Arial;
      background: linear-gradient(#000, #111);
      color: gold;
      text-align: center;
    }
    header { padding: 1rem; font-size: 1.5rem; border-bottom: 1px solid gold; }
    .tabbar {
      position: fixed; bottom: 0; width: 100%; background: #000; display: flex;
    }
    .tabbar div {
      flex: 1; padding: 1rem; border-top: 1px solid gold;
      cursor: pointer; color: gold;
    }
    .section { display: none; padding-bottom: 4rem; }
    .active { display: block; }
    button {
      background: gold; border: none; color: #000; font-weight: bold;
      padding: 10px 15px; margin: 5px; cursor: pointer;
    }
    input {
      padding: 8px; margin: 5px; width: 80%;
    }
    canvas { background: #222; margin-top: 10px; border: 1px solid gold; }
  </style>
</head>
<body>
  <header>Lilzok Marketplace</header>

  <div id="auth">
    <h3>Login or Register</h3>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
    <p id="authMsg"></p>
  </div>

  <div id="app" style="display:none;">
    <h3>Welcome <span id="userEmail"></span> <span id="badge"></span></h3>
    <p>Balance: $<span id="balance">0</span></p>

    <div id="market" class="section active">
      <h3>Commodities Market ($2 each)</h3>
      <button onclick="buy('Gold')">Buy Gold</button>
      <button onclick="buy('Diamond')">Buy Diamond</button>
      <button onclick="buy('SOL')">Buy SOL</button>
      <h3>Resell for $2.60 (Only Verified)</h3>
      <button onclick="sell('Gold')">Sell Gold</button>
      <button onclick="sell('Diamond')">Sell Diamond</button>
      <button onclick="sell('SOL')">Sell SOL</button>
      <canvas id="chart" width="300" height="150"></canvas>
    </div>

    <div id="referral" class="section">
      <h3>Your Referral Link:</h3>
      <p id="refLink"></p>
    </div>

    <div id="earn" class="section">
      <h3>Verify Your Account</h3>
      <input type="text" id="idLink" placeholder="Paste ID image URL"><br>
      <button onclick="verify()">Verify Me</button>
      <p>You must refer 8 users and deposit $1.50</p>
    </div>

    <div id="wallet" class="section">
      <h3>Wallet</h3>
      <p>Balance: $<span id="walletBalance">0</span></p>
      <button onclick="deposit()">Deposit</button>
      <button onclick="withdraw()">Withdraw ($4 min)</button>
    </div>

    <div class="tabbar">
      <div onclick="show('market')">Market</div>
      <div onclick="show('referral')">Referral</div>
      <div onclick="show('earn')">Earn</div>
      <div onclick="show('wallet')">Wallet</div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBoWx2QyoiJwxD1PvHw7Xib7RAlRYTfhCc",
      authDomain: "lilzok.firebaseapp.com",
      projectId: "lilzok",
      storageBucket: "lilzok.firebasestorage.app",
      messagingSenderId: "185365580013",
      appId: "1:185365580013:android:f33fd17ea7264edd6ba4e4"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let user = null;

    function login() {
      auth.signInWithEmailAndPassword(email.value, password.value)
      .catch(e => authMsg.innerText = e.message);
    }

    function register() {
      auth.createUserWithEmailAndPassword(email.value, password.value)
      .then(cred => {
        db.collection("users").doc(cred.user.uid).set({
          email: email.value, balance: 10, verified: false, referrals: 0, earnings: 0, id_uploaded: false
        });
      }).catch(e => authMsg.innerText = e.message);
    }

    auth.onAuthStateChanged(u => {
      if (u) {
        user = u;
        document.getElementById('auth').style.display = "none";
        document.getElementById('app').style.display = "block";
        load();
        chart();
      }
    });

    function load() {
      db.collection("users").doc(user.uid).onSnapshot(doc => {
        const d = doc.data();
        userEmail.innerText = d.email;
        balance.innerText = d.balance.toFixed(2);
        walletBalance.innerText = d.balance.toFixed(2);
        badge.innerText = d.verified ? "âœ… Verified" : "";
        refLink.innerText = `https://lilzok.com/register?ref=${user.uid}`;
      });
    }

    function show(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function deposit() {
      window.open("https://paystack.com/buy/lilzok-vjmgrv", "_blank");
    }

    function withdraw() {
      alert("Withdraw request sent. Minimum: $4");
    }

    function verify() {
      const id = idLink.value;
      db.collection("users").doc(user.uid).update({ verified: true, id_uploaded: true, id_url: id });
      alert("Verified successfully!");
    }

    function buy(item) {
      db.runTransaction(async t => {
        const ref = db.collection("users").doc(user.uid);
        const doc = await t.get(ref);
        const bal = doc.data().balance;
        if (bal < 2) return alert("Insufficient balance");
        t.update(ref, { balance: bal - 2 });
        alert(item + " bought for $2");
      });
    }

    function sell(item) {
      db.runTransaction(async t => {
        const ref = db.collection("users").doc(user.uid);
        const doc = await t.get(ref);
        const d = doc.data();
        if (!d.verified || !d.id_uploaded) return alert("You must be verified to resell");
        t.update(ref, {
          balance: d.balance + 2.45,
          earnings: firebase.firestore.FieldValue.increment(2.45)
        });
        alert(item + " sold. $0.15 goes to app");
      });
    }

    function chart() {
      db.collection("settings").doc("prices").onSnapshot(doc => {
        const d = doc.data();
        new Chart(document.getElementById("chart"), {
          type: "bar",
          data: {
            labels: ["Gold", "Diamond", "SOL"],
            datasets: [{
              label: "Price ($)",
              data: [d.gold, d.diamond, d.sol],
              backgroundColor: ["gold", "deepskyblue", "limegreen"]
            }]
          }
        });
      });
    }
  </script>
</body>
</html>
