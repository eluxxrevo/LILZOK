<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elsa App</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #000000, #4b3621);
      color: gold;
    }
    .section, .auth-page { display: none; padding: 20px; }
    .active { display: block; }
    .tab-bar {
      display: none;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      padding: 10px;
    }
    .tab-bar button {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      color: gold;
      font-size: 14px;
    }
    button {
      background: gold;
      color: black;
      padding: 10px;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 5px;
    }
    #notif {
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin: 10px;
      text-align: center;
      display: none;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      onSnapshot,
      collection,
      query,
      orderBy,
      getDocs
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyC8kLmGOyODdlrvHId2Nz3opdpT0tvD5mk",
  authDomain: "elsa-ab176.firebaseapp.com",
  projectId: "elsa-ab176",
  storageBucket: "elsa-ab176.appspot.com",
  messagingSenderId: "850786583459",
  appId: "1:850786583459:android:5710287d8738f48e8e1016"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

let userId = null;
let refBy = new URLSearchParams(location.search).get("ref");

function showNotification(msg) {
  const n = document.getElementById("notif");
  n.innerText = msg;
  n.style.display = "block";
  setTimeout(() => (n.style.display = "none"), 3000);
}

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showLogin() {
  document.getElementById('loginPage').classList.add('active');
  document.getElementById('registerPage').classList.remove('active');
}

function showRegister() {
  document.getElementById('registerPage').classList.add('active');
  document.getElementById('loginPage').classList.remove('active');
}

window.login = function () {
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  signInWithEmailAndPassword(auth, email, password)
    .then(userCred => initApp(userCred.user))
    .catch(err => showNotification("Login failed: " + err.message));
};

window.register = function () {
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;
  createUserWithEmailAndPassword(auth, email, password).then(res => {
    const refCode = res.user.uid.slice(0, 6);
    setDoc(doc(db, "users", res.user.uid), {
      email,
      balance: email === "eluxxes@gmail.com" ? 10 : 0,
      verified: false,
      referrals: 0,
      refcode: refCode,
      referredBy: refBy || null
    });
    initApp(res.user);
  }).catch(err => showNotification("Register failed: " + err.message));
};

function initApp(user) {
  userId = user.uid;
  document.getElementById("loginPage").style.display = "none";
  document.getElementById("registerPage").style.display = "none";
  document.querySelector(".tab-bar").style.display = "flex";
  showSection('market');

  const uDoc = doc(db, "users", userId);
  onSnapshot(uDoc, docSnap => {
    const d = docSnap.data();
    document.getElementById("userBalance").innerText = d.balance.toFixed(2);
    document.getElementById("userEmail").innerText = d.email;
    document.getElementById("verifyStatus").innerText = d.verified ? "Verified ✅" : "Not Verified ❌";
  });
}

onAuthStateChanged(auth, user => { if (user) initApp(user); });

  </script>
</head>
<body>
<div id="notif"></div>
<div id="loginPage" class="auth-page active">
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p>Don't have an account? <a href="#" onclick="showRegister()">Register</a></p>
</div>
<div id="registerPage" class="auth-page">
  <h2>Register</h2>
  <input id="regEmail" placeholder="Email">
  <input id="regPassword" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>
<div id="market" class="section">
  <h2>Market</h2>
  <p>Price: $<span id="priceDisplay">2.00</span></p>
  <button onclick="buyCommodity()">Buy</button>
  <button onclick="sellCommodity()">Sell</button>
</div>
<div id="wallet" class="section">
  <h2>Wallet</h2>
  <p>Balance: $<span id="userBalance"></span></p>
</div>
<div id="profile" class="section">
  <h2>Profile</h2>
  <p>Email: <span id="userEmail"></span></p>
  <p>Status: <span id="verifyStatus"></span></p>
</div>
<div class="tab-bar">
  <button onclick="showSection('market')">Market</button>
  <button onclick="showSection('wallet')">Wallet</button>
  <button onclick="showSection('profile')">Profile</button>
</div>
</body>
</html
