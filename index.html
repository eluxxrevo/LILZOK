<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elsa Coin</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: linear-gradient(to right, #000, #222); color: gold; font-family: Arial, sans-serif; }
    .page { display: none; padding: 20px; }
    .active { display: block; }
    nav { position: fixed; bottom: 0; width: 100%; background: #111; display: flex; justify-content: space-around; }
    nav button { background: none; border: none; color: gold; padding: 10px; }
    .form-control, .btn { margin-bottom: 10px; }
  </style>
</head>
<body>
<div id="authPage" class="page active">
  <h2>Login to Elsa</h2>
  <input id="email" class="form-control" placeholder="Email" type="email">
  <input id="password" class="form-control" placeholder="Password" type="password">
  <button onclick="login()" class="btn btn-warning">Login</button>
  <p>or</p>
  <button onclick="register()" class="btn btn-dark">Register</button>
</div><div id="homePage" class="page">
  <h2>Welcome to Elsa Coin</h2>
  <canvas id="priceChart"></canvas>
  <button onclick="buyCoin()" class="btn btn-success">Buy Elsa</button>
  <button onclick="sellCoin()" class="btn btn-danger">Sell Elsa</button>
</div><div id="walletPage" class="page">
  <h2>Your Wallet</h2>
  <p id="walletInfo"></p>
  <button onclick="deposit()" class="btn btn-success">Deposit</button>
  <button onclick="requestWithdraw()" class="btn btn-danger">Withdraw</button>
  <h4>Transactions:</h4>
  <ul id="transactions"></ul>
</div><div id="referralPage" class="page">
  <h2>Your Referral</h2>
  <p id="refLink"></p>
</div><nav>
  <button onclick="showPage('homePage')">üè†</button>
  <button onclick="showPage('walletPage')">üíº</button>
  <button onclick="showPage('referralPage')">ü§ù</button>
</nav><script>
  const firebaseConfig = {
    apiKey: "AIzaSyApuMISYyAXo7Xdxa_FAYDG-tHaU5vJA6A",
    authDomain: "elsa-809c1.firebaseapp.com",
    projectId: "elsa-809c1",
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  async function login() {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      await auth.signInWithEmailAndPassword(email, password);
      postLogin();
    } catch (err) {
      alert('Login failed');
    }
  }

  async function register() {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      const userCred = await auth.createUserWithEmailAndPassword(email, password);
      await db.collection('users').doc(userCred.user.uid).set({
        email,
        balance: email === 'eluxxes@gmail.com' ? 2000 : 0,
        referrals: 0,
        uid: userCred.user.uid,
        transactions: [],
        referredBy: ''
      });
      postLogin();
    } catch (err) {
      alert('Registration failed');
    }
  }

  async function postLogin() {
    document.getElementById('authPage').classList.remove('active');
    document.getElementById('homePage').classList.add('active');
    const uid = auth.currentUser.uid;
    const userDoc = await db.collection('users').doc(uid).get();
    const user = userDoc.data();
    document.getElementById('walletInfo').textContent = `Balance: ${user.balance} ELSA`;
    const ref = location.href + '?ref=' + uid;
    document.getElementById('refLink').textContent = `Your referral link: ${ref}`;
    loadChart();
    loadTransactions();
  }

  async function deposit() {
    window.open('https://paystack.com/buy/lilzok-vjmgrv', '_blank');
  }

  async function requestWithdraw() {
    const uid = auth.currentUser.uid;
    const amount = prompt("Enter amount to withdraw");
    if (!amount || isNaN(amount)) return alert("Invalid amount");
    await db.collection('withdrawals').add({ uid, amount: parseFloat(amount), time: Date.now() });
    alert("Withdraw request submitted");
  }

  async function buyCoin() {
    const uid = auth.currentUser.uid;
    const amount = prompt("Amount of Elsa to buy (min 0.01)");
    if (!amount || isNaN(amount)) return alert("Invalid input");
    const docRef = db.collection('users').doc(uid);
    await docRef.update({
      balance: firebase.firestore.FieldValue.increment(parseFloat(amount)),
      transactions: firebase.firestore.FieldValue.arrayUnion({ type: 'buy', amount, time: Date.now() })
    });
    alert("Purchase successful");
    postLogin();
  }

  async function sellCoin() {
    const uid = auth.currentUser.uid;
    const amount = prompt("Amount of Elsa to sell");
    if (!amount || isNaN(amount)) return alert("Invalid input");
    const docRef = db.collection('users').doc(uid);
    const user = (await docRef.get()).data();
    if (user.balance < amount) return alert("Insufficient Elsa");
    await docRef.update({
      balance: firebase.firestore.FieldValue.increment(-parseFloat(amount)),
      transactions: firebase.firestore.FieldValue.arrayUnion({ type: 'sell', amount, time: Date.now() })
    });
    alert("Sell successful");
    postLogin();
  }

  async function loadTransactions() {
    const uid = auth.currentUser.uid;
    const user = (await db.collection('users').doc(uid).get()).data();
    const txList = document.getElementById('transactions');
    txList.innerHTML = '';
    user.transactions.slice().reverse().forEach(tx => {
      const li = document.createElement('li');
      li.textContent = `${tx.type} ${tx.amount} @ ${new Date(tx.time).toLocaleString()}`;
      txList.appendChild(li);
    });
  }

  function loadChart() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    let dataPoints = [];
    db.collection('chartData').orderBy('time').limit(20).onSnapshot(snapshot => {
      dataPoints = snapshot.docs.map(doc => doc.data().value);
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: dataPoints.length}, (_, i) => i + 1),
          datasets: [{ label: 'ELSA Price', data: dataPoints, borderColor: 'gold', fill: false }]
        },
        options: { animation: false }
      });
    });
  }

  auth.onAuthStateChanged(user => { if (user) postLogin(); });
</script></body>
</html>
